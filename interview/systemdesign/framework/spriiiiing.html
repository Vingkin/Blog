<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vingkin.github.io/Blog/Blog/interview/systemdesign/framework/spriiiiing.html"><meta property="og:site_name" content="Vingkin的学习博客"><meta property="og:title" content="Spring 高级"><meta property="og:description" content="容器与 bean 1) 容器接口 BeanFactory 接口，典型功能有： getBean ApplicationContext 接口，是 BeanFactory 的子接口。它扩展了 BeanFactory 接口的功能，如： 国际化 通配符方式获取一组 Resource 资源 整合 Environment 环境（能通过它获取各种来源的配置信息） 事件发布与监听，实现组件之间的解耦"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-09-25T15:52:09.000Z"><meta property="article:author" content="Vingkin"><meta property="article:modified_time" content="2023-09-25T15:52:09.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Spring 高级","image":[""],"dateModified":"2023-09-25T15:52:09.000Z","author":[{"@type":"Person","name":"Vingkin"}]}</script><title>Spring 高级 | Vingkin的学习博客</title><meta name="description" content="容器与 bean 1) 容器接口 BeanFactory 接口，典型功能有： getBean ApplicationContext 接口，是 BeanFactory 的子接口。它扩展了 BeanFactory 接口的功能，如： 国际化 通配符方式获取一组 Resource 资源 整合 Environment 环境（能通过它获取各种来源的配置信息） 事件发布与监听，实现组件之间的解耦">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/Blog/assets/style-4d825508.css" as="style"><link rel="stylesheet" href="/Blog/assets/style-4d825508.css">
    <link rel="modulepreload" href="/Blog/assets/app-ee96bbef.js"><link rel="modulepreload" href="/Blog/assets/spriiiiing.html-1c9bda1a.js"><link rel="modulepreload" href="/Blog/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/Blog/assets/spriiiiing.html-f7bbddb2.js"><link rel="prefetch" href="/Blog/assets/intro.html-be733649.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-0349f88a.js" as="script"><link rel="prefetch" href="/Blog/assets/slides.html-1e7b7b09.js" as="script"><link rel="prefetch" href="/Blog/assets/Adapter.html-7ec25bf5.js" as="script"><link rel="prefetch" href="/Blog/assets/Builder.html-051a54a4.js" as="script"><link rel="prefetch" href="/Blog/assets/DesignMode.html-f6ad6398.js" as="script"><link rel="prefetch" href="/Blog/assets/Factory.html-0ff08a4a.js" as="script"><link rel="prefetch" href="/Blog/assets/Observer.html-0a20907b.js" as="script"><link rel="prefetch" href="/Blog/assets/Prototype.html-e053c5ed.js" as="script"><link rel="prefetch" href="/Blog/assets/Proxy.html-af834188.js" as="script"><link rel="prefetch" href="/Blog/assets/Singleton.html-23deb82a.js" as="script"><link rel="prefetch" href="/Blog/assets/SoftwareDesignPrinciples.html-ab505183.js" as="script"><link rel="prefetch" href="/Blog/assets/Strategy.html-fd403447.js" as="script"><link rel="prefetch" href="/Blog/assets/Template.html-3dc7bc52.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-aac1b35e.js" as="script"><link rel="prefetch" href="/Blog/assets/CycleGAN.html-af22312b.js" as="script"><link rel="prefetch" href="/Blog/assets/GAN.html-838e8100.js" as="script"><link rel="prefetch" href="/Blog/assets/pix2pix.html-00fe3a4f.js" as="script"><link rel="prefetch" href="/Blog/assets/YOLOv3.html-2ec30e22.js" as="script"><link rel="prefetch" href="/Blog/assets/读前须知.html-2039ff26.js" as="script"><link rel="prefetch" href="/Blog/assets/OS1.html-e361492e.js" as="script"><link rel="prefetch" href="/Blog/assets/OS2.html-ef9d5f51.js" as="script"><link rel="prefetch" href="/Blog/assets/OS3.html-5adf4aeb.js" as="script"><link rel="prefetch" href="/Blog/assets/AI.html-9496054f.js" as="script"><link rel="prefetch" href="/Blog/assets/books.html-057309da.js" as="script"><link rel="prefetch" href="/Blog/assets/Windows.html-3a7dadfe.js" as="script"><link rel="prefetch" href="/Blog/assets/1.html-f18cd823.js" as="script"><link rel="prefetch" href="/Blog/assets/2.html-722cff6e.js" as="script"><link rel="prefetch" href="/Blog/assets/3.html-f6b0486d.js" as="script"><link rel="prefetch" href="/Blog/assets/4.html-69c41cab.js" as="script"><link rel="prefetch" href="/Blog/assets/5.html-de0ccabb.js" as="script"><link rel="prefetch" href="/Blog/assets/6.html-71d7f46d.js" as="script"><link rel="prefetch" href="/Blog/assets/high_frequency_words.html-f1f032ae.js" as="script"><link rel="prefetch" href="/Blog/assets/CodeTemplate.html-53869323.js" as="script"><link rel="prefetch" href="/Blog/assets/ComputerNetwork.html-248798e5.js" as="script"><link rel="prefetch" href="/Blog/assets/DataStructure.html-3be5d74b.js" as="script"><link rel="prefetch" href="/Blog/assets/OS.html-99d5b17d.js" as="script"><link rel="prefetch" href="/Blog/assets/DatabaseGuidelines.html-6cdbd9a2.js" as="script"><link rel="prefetch" href="/Blog/assets/Mysql.html-352b2080.js" as="script"><link rel="prefetch" href="/Blog/assets/Redis.html-3cc4a271.js" as="script"><link rel="prefetch" href="/Blog/assets/ReactiveStream.html-be0e2d19.js" as="script"><link rel="prefetch" href="/Blog/assets/webflux.html-e8bac78d.js" as="script"><link rel="prefetch" href="/Blog/assets/concurrent.html-aedc2210.js" as="script"><link rel="prefetch" href="/Blog/assets/Java.html-d4adf683.js" as="script"><link rel="prefetch" href="/Blog/assets/JDK8.html-dcc80635.js" as="script"><link rel="prefetch" href="/Blog/assets/JVM.html-d84de37a.js" as="script"><link rel="prefetch" href="/Blog/assets/bag.html-1cac74a2.js" as="script"><link rel="prefetch" href="/Blog/assets/chatroom.html-c67593cf.js" as="script"><link rel="prefetch" href="/Blog/assets/protocol.html-275f4f8a.js" as="script"><link rel="prefetch" href="/Blog/assets/component.html-c6e8667d.js" as="script"><link rel="prefetch" href="/Blog/assets/helloworld.html-0691ad0c.js" as="script"><link rel="prefetch" href="/Blog/assets/summary.html-14cfeca0.js" as="script"><link rel="prefetch" href="/Blog/assets/two_way_communication.html-267dafd9.js" as="script"><link rel="prefetch" href="/Blog/assets/bytebuffer.html-82ccb83c.js" as="script"><link rel="prefetch" href="/Blog/assets/file_programming.html-3a4f630e.js" as="script"><link rel="prefetch" href="/Blog/assets/network_programming.html-b2d22e09.js" as="script"><link rel="prefetch" href="/Blog/assets/NIOvsBIO.html-a208eac3.js" as="script"><link rel="prefetch" href="/Blog/assets/three_component.html-a615e6c3.js" as="script"><link rel="prefetch" href="/Blog/assets/optimization.html-bd9bcd7a.js" as="script"><link rel="prefetch" href="/Blog/assets/source_code.html-24c367c1.js" as="script"><link rel="prefetch" href="/Blog/assets/1.html-d52bb900.js" as="script"><link rel="prefetch" href="/Blog/assets/2.html-29ba066e.js" as="script"><link rel="prefetch" href="/Blog/assets/3.html-2f7bd8bb.js" as="script"><link rel="prefetch" href="/Blog/assets/4.html-1d6eb15f.js" as="script"><link rel="prefetch" href="/Blog/assets/1.html-aae50647.js" as="script"><link rel="prefetch" href="/Blog/assets/1.html-d9403d83.js" as="script"><link rel="prefetch" href="/Blog/assets/2.html-2c8d8d31.js" as="script"><link rel="prefetch" href="/Blog/assets/3.html-f373babb.js" as="script"><link rel="prefetch" href="/Blog/assets/4.html-a764f314.js" as="script"><link rel="prefetch" href="/Blog/assets/5.html-7c75de8f.js" as="script"><link rel="prefetch" href="/Blog/assets/SnowFlake.html-8643e58d.js" as="script"><link rel="prefetch" href="/Blog/assets/ElasticSearchApp.html-2561ed51.js" as="script"><link rel="prefetch" href="/Blog/assets/ElasticSearchBase.html-e4b8f4fe.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-9173b604.js" as="script"><link rel="prefetch" href="/Blog/assets/RedisApp.html-c2f5b573.js" as="script"><link rel="prefetch" href="/Blog/assets/RedisBase.html-1046c1e2.js" as="script"><link rel="prefetch" href="/Blog/assets/MyBatis.html-97c97d80.js" as="script"><link rel="prefetch" href="/Blog/assets/Spring.html-6d070447.js" as="script"><link rel="prefetch" href="/Blog/assets/SpringBoot.html-82e5a47e.js" as="script"><link rel="prefetch" href="/Blog/assets/SpringMVC.html-ae8342c4.js" as="script"><link rel="prefetch" href="/Blog/assets/Idempotency.html-ed0e6919.js" as="script"><link rel="prefetch" href="/Blog/assets/404.html-9ce137e5.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-5ab75925.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-b19957bf.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-d75ab2f0.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-d9a5c719.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-a2d3b7ed.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-8e697f89.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-5a02c92d.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-be754c22.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-c94da89c.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-e14ecdde.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-74d1c726.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-b73ddddc.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-af4fb2d4.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-eda9a8c1.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-e9b2a7e9.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-12d6d08a.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-1dd664bd.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-83ff6629.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-e9ad9d13.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-a61188e9.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-c0307da4.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-c72aa404.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-bc595c00.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-05ff3c77.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-e24777eb.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-2c586d25.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-6ae362c0.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-4803f852.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-880cc084.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-098c8e2c.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-1b222abe.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-fed54aa1.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-61ba3395.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-18415c4c.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-5633aad8.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-fa6d7f17.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-44bd4a32.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-624a71af.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-589901de.js" as="script"><link rel="prefetch" href="/Blog/assets/intro.html-7843df9d.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-38722f85.js" as="script"><link rel="prefetch" href="/Blog/assets/slides.html-9c944366.js" as="script"><link rel="prefetch" href="/Blog/assets/Adapter.html-a3827e42.js" as="script"><link rel="prefetch" href="/Blog/assets/Builder.html-7391405e.js" as="script"><link rel="prefetch" href="/Blog/assets/DesignMode.html-11c6ae40.js" as="script"><link rel="prefetch" href="/Blog/assets/Factory.html-5c3b15a6.js" as="script"><link rel="prefetch" href="/Blog/assets/Observer.html-01531d75.js" as="script"><link rel="prefetch" href="/Blog/assets/Prototype.html-f570e486.js" as="script"><link rel="prefetch" href="/Blog/assets/Proxy.html-07db6fcb.js" as="script"><link rel="prefetch" href="/Blog/assets/Singleton.html-9a4aa90f.js" as="script"><link rel="prefetch" href="/Blog/assets/SoftwareDesignPrinciples.html-0e5995b6.js" as="script"><link rel="prefetch" href="/Blog/assets/Strategy.html-9b644183.js" as="script"><link rel="prefetch" href="/Blog/assets/Template.html-ac68fc61.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-50cd3092.js" as="script"><link rel="prefetch" href="/Blog/assets/CycleGAN.html-2f4f6250.js" as="script"><link rel="prefetch" href="/Blog/assets/GAN.html-8e01b3f1.js" as="script"><link rel="prefetch" href="/Blog/assets/pix2pix.html-60cffc9f.js" as="script"><link rel="prefetch" href="/Blog/assets/YOLOv3.html-80d0c81a.js" as="script"><link rel="prefetch" href="/Blog/assets/读前须知.html-eaf57285.js" as="script"><link rel="prefetch" href="/Blog/assets/OS1.html-f06451c0.js" as="script"><link rel="prefetch" href="/Blog/assets/OS2.html-e58f51ee.js" as="script"><link rel="prefetch" href="/Blog/assets/OS3.html-e7141895.js" as="script"><link rel="prefetch" href="/Blog/assets/AI.html-8f3933de.js" as="script"><link rel="prefetch" href="/Blog/assets/books.html-05f35599.js" as="script"><link rel="prefetch" href="/Blog/assets/Windows.html-9549e5dc.js" as="script"><link rel="prefetch" href="/Blog/assets/1.html-b91bb32a.js" as="script"><link rel="prefetch" href="/Blog/assets/2.html-0f64cc60.js" as="script"><link rel="prefetch" href="/Blog/assets/3.html-e0c94c94.js" as="script"><link rel="prefetch" href="/Blog/assets/4.html-b9175b1e.js" as="script"><link rel="prefetch" href="/Blog/assets/5.html-634b171b.js" as="script"><link rel="prefetch" href="/Blog/assets/6.html-2d4eb653.js" as="script"><link rel="prefetch" href="/Blog/assets/high_frequency_words.html-b0a34334.js" as="script"><link rel="prefetch" href="/Blog/assets/CodeTemplate.html-da77b15d.js" as="script"><link rel="prefetch" href="/Blog/assets/ComputerNetwork.html-cdcbda4a.js" as="script"><link rel="prefetch" href="/Blog/assets/DataStructure.html-a10be348.js" as="script"><link rel="prefetch" href="/Blog/assets/OS.html-7d9531e9.js" as="script"><link rel="prefetch" href="/Blog/assets/DatabaseGuidelines.html-4f88d794.js" as="script"><link rel="prefetch" href="/Blog/assets/Mysql.html-cc5a3118.js" as="script"><link rel="prefetch" href="/Blog/assets/Redis.html-0ee39dc0.js" as="script"><link rel="prefetch" href="/Blog/assets/ReactiveStream.html-5ed6d051.js" as="script"><link rel="prefetch" href="/Blog/assets/webflux.html-861036c1.js" as="script"><link rel="prefetch" href="/Blog/assets/concurrent.html-953b2cd7.js" as="script"><link rel="prefetch" href="/Blog/assets/Java.html-70fe0974.js" as="script"><link rel="prefetch" href="/Blog/assets/JDK8.html-e6cdac06.js" as="script"><link rel="prefetch" href="/Blog/assets/JVM.html-d7de0e18.js" as="script"><link rel="prefetch" href="/Blog/assets/bag.html-7cfed568.js" as="script"><link rel="prefetch" href="/Blog/assets/chatroom.html-61ec6eb4.js" as="script"><link rel="prefetch" href="/Blog/assets/protocol.html-f1c39c0e.js" as="script"><link rel="prefetch" href="/Blog/assets/component.html-dd630c29.js" as="script"><link rel="prefetch" href="/Blog/assets/helloworld.html-d24fbef4.js" as="script"><link rel="prefetch" href="/Blog/assets/summary.html-907c1270.js" as="script"><link rel="prefetch" href="/Blog/assets/two_way_communication.html-e445cb1a.js" as="script"><link rel="prefetch" href="/Blog/assets/bytebuffer.html-d51badf9.js" as="script"><link rel="prefetch" href="/Blog/assets/file_programming.html-3417f73f.js" as="script"><link rel="prefetch" href="/Blog/assets/network_programming.html-1071fb0d.js" as="script"><link rel="prefetch" href="/Blog/assets/NIOvsBIO.html-115ca963.js" as="script"><link rel="prefetch" href="/Blog/assets/three_component.html-bc9cbb35.js" as="script"><link rel="prefetch" href="/Blog/assets/optimization.html-83b679e5.js" as="script"><link rel="prefetch" href="/Blog/assets/source_code.html-7c476736.js" as="script"><link rel="prefetch" href="/Blog/assets/1.html-46206eee.js" as="script"><link rel="prefetch" href="/Blog/assets/2.html-b1383c80.js" as="script"><link rel="prefetch" href="/Blog/assets/3.html-b21e3088.js" as="script"><link rel="prefetch" href="/Blog/assets/4.html-f8d7a23d.js" as="script"><link rel="prefetch" href="/Blog/assets/1.html-baa4f504.js" as="script"><link rel="prefetch" href="/Blog/assets/1.html-1c8cefaf.js" as="script"><link rel="prefetch" href="/Blog/assets/2.html-8b78e81b.js" as="script"><link rel="prefetch" href="/Blog/assets/3.html-b0586a5d.js" as="script"><link rel="prefetch" href="/Blog/assets/4.html-ec8f1942.js" as="script"><link rel="prefetch" href="/Blog/assets/5.html-b0013aa4.js" as="script"><link rel="prefetch" href="/Blog/assets/SnowFlake.html-aebec3d9.js" as="script"><link rel="prefetch" href="/Blog/assets/ElasticSearchApp.html-b36b1362.js" as="script"><link rel="prefetch" href="/Blog/assets/ElasticSearchBase.html-68821253.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-5d9f40da.js" as="script"><link rel="prefetch" href="/Blog/assets/RedisApp.html-547a781c.js" as="script"><link rel="prefetch" href="/Blog/assets/RedisBase.html-e35c7bfa.js" as="script"><link rel="prefetch" href="/Blog/assets/MyBatis.html-4d74bcda.js" as="script"><link rel="prefetch" href="/Blog/assets/Spring.html-671d323b.js" as="script"><link rel="prefetch" href="/Blog/assets/SpringBoot.html-433df757.js" as="script"><link rel="prefetch" href="/Blog/assets/SpringMVC.html-ece647d0.js" as="script"><link rel="prefetch" href="/Blog/assets/Idempotency.html-51c47acb.js" as="script"><link rel="prefetch" href="/Blog/assets/404.html-8a71821f.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-d2009dd6.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-e7f6b9a5.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-a4423cf0.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-4d819453.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-27d69202.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-7805bfe7.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-9f0af14a.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-26d1c9e8.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-29aa7348.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-2a627260.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-c65ae1da.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-f9e77cfb.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-da76bbe9.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-6939a1a8.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-916b3ce9.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-878a67d8.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-4d2204a8.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-a2496729.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-20dc3a29.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-29714338.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-fc4d1e2c.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-e7e1da03.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-7551a568.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-776ad333.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-42daadba.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-10f92a30.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-f2bc7381.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-3200914f.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-5313f5c5.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-757b577d.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-be715abf.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-53b5fc32.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-dbbd8823.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-04e6ff8e.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-898e5158.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-f5e78224.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-f93fdbbf.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-ba12edcb.js" as="script"><link rel="prefetch" href="/Blog/assets/index.html-d7825beb.js" as="script"><link rel="prefetch" href="/Blog/assets/plyr.min-d2156373.js" as="script"><link rel="prefetch" href="/Blog/assets/waline-meta-56fbc549.js" as="script"><link rel="prefetch" href="/Blog/assets/component-476b89fc.js" as="script"><link rel="prefetch" href="/Blog/assets/auto-6adc87e8.js" as="script"><link rel="prefetch" href="/Blog/assets/index-2bf332f6.js" as="script"><link rel="prefetch" href="/Blog/assets/flowchart-c441f34d.js" as="script"><link rel="prefetch" href="/Blog/assets/mermaid.core-52de1954.js" as="script"><link rel="prefetch" href="/Blog/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/Blog/assets/markdown.esm-9d5bc2ce.js" as="script"><link rel="prefetch" href="/Blog/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/Blog/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/Blog/assets/reveal.esm-1a4c3ae7.js" as="script"><link rel="prefetch" href="/Blog/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/Blog/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/Blog/assets/VuePlayground-8bf94df1.js" as="script"><link rel="prefetch" href="/Blog/assets/photoswipe.esm-060dc2da.js" as="script"><link rel="prefetch" href="/Blog/assets/SearchResult-539dac79.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/Blog/"><img class="vp-nav-logo" src="/Blog/logo.gif" alt="Vingkin的学习博客"><!----><span class="vp-site-name hide-in-pad">Vingkin的学习博客</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="主页" class="vp-link nav-link nav-link" href="/Blog/"><span class="font-icon icon fa-fw fa-sm fa-solid fa-house fa-sm" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="博文"><span class="title"><span class="font-icon icon fa-fw fa-sm fa-solid fa-book-open-reader fa-sm" style=""></span>博文</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>微服务</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="中间件" class="vp-link nav-link nav-link" href="/Blog/microservice/middleware/"><img class="icon" src="/Blog/assets/icon/Middleware.svg" no-view style="">中间件<!----></a></li><li class="dropdown-subitem"><a aria-label="响应式编程" class="vp-link nav-link nav-link" href="/Blog/microservice/reactive/"><img class="icon" src="/Blog/assets/icon/reactive_programming.svg" no-view style="">响应式编程<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>大数据</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="Hadoop" class="vp-link nav-link nav-link" href="/Blog/bigdata/hadoop/"><img class="icon" src="/Blog/assets/icon/Hadoop.svg" no-view style="">Hadoop<!----></a></li><li class="dropdown-subitem"><a aria-label="Hive" class="vp-link nav-link nav-link" href="/Blog/bigdata/hive/"><img class="icon" src="/Blog/assets/icon/hive.svg" no-view style="">Hive<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>八股</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="Java" class="vp-link nav-link nav-link" href="/Blog/interview/java.html"><span class="font-icon icon fa-fw fa-sm fab fa-java" style=""></span>Java<!----></a></li><li class="dropdown-subitem"><a aria-label="系统设计" class="vp-link nav-link active nav-link active" href="/Blog/interview/systemdesign.html"><img class="icon" src="/Blog/assets/icon/system_design.svg" no-view style="">系统设计<!----></a></li><li class="dropdown-subitem"><a aria-label="数据库" class="vp-link nav-link nav-link" href="/Blog/interview/database.html"><span class="font-icon icon fa-fw fa-sm fa-solid fa-database" style=""></span>数据库<!----></a></li><li class="dropdown-subitem"><a aria-label="计算机基础" class="vp-link nav-link nav-link" href="/Blog/interview/computer.html"><span class="font-icon icon fa-fw fa-sm fa-solid fa-computer" style=""></span>计算机基础<!----></a></li><li class="dropdown-subitem"><a aria-label="海量数据" class="vp-link nav-link nav-link" href="/Blog/interview/bigdata.html"><img class="icon" src="/Blog/assets/icon/data.svg" no-view style="">海量数据<!----></a></li><li class="dropdown-subitem"><a aria-label="分布式" class="vp-link nav-link nav-link" href="/Blog/interview/distributed.html"><span class="font-icon icon fa-fw fa-sm fa-brands fa-docker" style=""></span>分布式<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>其他</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="Maven" class="vp-link nav-link nav-link" href="/Blog/maven/"><img class="icon" src="/Blog/assets/icon/Maven.svg" no-view style="">Maven<!----></a></li><li class="dropdown-subitem"><a aria-label="设计模式" class="vp-link nav-link nav-link" href="/Blog/designmode.html"><img class="icon" src="/Blog/assets/icon/design.svg" no-view style="">设计模式<!----></a></li><li class="dropdown-subitem"><a aria-label="Netty" class="vp-link nav-link nav-link" href="/Blog/netty/"><img class="icon" src="/Blog/assets/icon/Netty_16.svg" no-view style="">Netty<!----></a></li><li class="dropdown-subitem"><a aria-label="机器学习" class="vp-link nav-link nav-link" href="/Blog/ml/"><img class="icon" src="/Blog/assets/icon/AI.svg" no-view style="">机器学习<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a aria-label="工具箱" class="vp-link nav-link nav-link" href="/Blog/tools.html"><span class="font-icon icon fa-fw fa-sm fa-solid fa-toolbox fg-lg" style=""></span>工具箱<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/vingkin/Blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-brands fa-java fa-lg" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><img class="icon" src="/Blog/assets/icon/system_design_20.svg" no-view style=""><span class="vp-sidebar-title">系统设计</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">开发框架</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a aria-label="Spring" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/Blog/interview/systemdesign/framework/Spring.html"><!---->Spring<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Spring 高级" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/Blog/interview/systemdesign/framework/spriiiiing.html"><!---->Spring 高级<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="容器与 bean" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#容器与-bean"><!---->容器与 bean<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="1) 容器接口" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_1-容器接口"><!---->1) 容器接口<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="2) 容器实现" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_2-容器实现"><!---->2) 容器实现<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="3) Bean 的生命周期" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_3-bean-的生命周期"><!---->3) Bean 的生命周期<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="4) Bean 后处理器" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_4-bean-后处理器"><!---->4) Bean 后处理器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="5) BeanFactory 后处理器" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_5-beanfactory-后处理器"><!---->5) BeanFactory 后处理器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="6) Aware 接口" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_6-aware-接口"><!---->6) Aware 接口<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="7) 初始化与销毁" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_7-初始化与销毁"><!---->7) 初始化与销毁<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="8) Scope" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_8-scope"><!---->8) Scope<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="AOP" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#aop"><!---->AOP<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="9) AOP 实现之 ajc 编译器" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_9-aop-实现之-ajc-编译器"><!---->9) AOP 实现之 ajc 编译器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="10) AOP 实现之 agent 类加载" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_10-aop-实现之-agent-类加载"><!---->10) AOP 实现之 agent 类加载<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="11) AOP 实现之 proxy" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_11-aop-实现之-proxy"><!---->11) AOP 实现之 proxy<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="12) jdk 动态代理进阶" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_12-jdk-动态代理进阶"><!---->12) jdk 动态代理进阶<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="13) cglib 代理进阶" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_13-cglib-代理进阶"><!---->13) cglib 代理进阶<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="14) cglib 避免反射调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_14-cglib-避免反射调用"><!---->14) cglib 避免反射调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="15) jdk 和 cglib 在 Spring 中的统一" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_15-jdk-和-cglib-在-spring-中的统一"><!---->15) jdk 和 cglib 在 Spring 中的统一<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="16) 切点匹配" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_16-切点匹配"><!---->16) 切点匹配<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="17) 从 @Aspect 到 Advisor" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_17-从-aspect-到-advisor"><!---->17) 从 @Aspect 到 Advisor<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="18) 静态通知调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_18-静态通知调用"><!---->18) 静态通知调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="19) 动态通知调用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_19-动态通知调用"><!---->19) 动态通知调用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="WEB" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#web"><!---->WEB<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="20) RequestMappingHandlerMapping 与 RequestMappingHandlerAdapter" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_20-requestmappinghandlermapping-与-requestmappinghandleradapter"><!---->20) RequestMappingHandlerMapping 与 RequestMappingHandlerAdapter<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="21) 参数解析器" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_21-参数解析器"><!---->21) 参数解析器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="22) 参数名解析" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_22-参数名解析"><!---->22) 参数名解析<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="23) 对象绑定与类型转换" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_23-对象绑定与类型转换"><!---->23) 对象绑定与类型转换<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="24) @ControllerAdvice 之 @InitBinder" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_24-controlleradvice-之-initbinder"><!---->24) @ControllerAdvice 之 @InitBinder<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="25) 控制器方法执行流程" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_25-控制器方法执行流程"><!---->25) 控制器方法执行流程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="26) @ControllerAdvice 之 @ModelAttribute" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_26-controlleradvice-之-modelattribute"><!---->26) @ControllerAdvice 之 @ModelAttribute<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="27) 返回值处理器" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_27-返回值处理器"><!---->27) 返回值处理器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="28) MessageConverter" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_28-messageconverter"><!---->28) MessageConverter<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="29) @ControllerAdvice 之 ResponseBodyAdvice" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_29-controlleradvice-之-responsebodyadvice"><!---->29) @ControllerAdvice 之 ResponseBodyAdvice<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="30) 异常解析器" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_30-异常解析器"><!---->30) 异常解析器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="31) @ControllerAdvice 之 @ExceptionHandler" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_31-controlleradvice-之-exceptionhandler"><!---->31) @ControllerAdvice 之 @ExceptionHandler<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="32) Tomcat 异常处理" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_32-tomcat-异常处理"><!---->32) Tomcat 异常处理<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="33) BeanNameUrlHandlerMapping 与 SimpleControllerHandlerAdapter" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_33-beannameurlhandlermapping-与-simplecontrollerhandleradapter"><!---->33) BeanNameUrlHandlerMapping 与 SimpleControllerHandlerAdapter<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="34) RouterFunctionMapping 与 HandlerFunctionAdapter" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_34-routerfunctionmapping-与-handlerfunctionadapter"><!---->34) RouterFunctionMapping 与 HandlerFunctionAdapter<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="35) SimpleUrlHandlerMapping 与 HttpRequestHandlerAdapter" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_35-simpleurlhandlermapping-与-httprequesthandleradapter"><!---->35) SimpleUrlHandlerMapping 与 HttpRequestHandlerAdapter<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="36) mvc 处理流程" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_36-mvc-处理流程"><!---->36) mvc 处理流程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Boot" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#boot"><!---->Boot<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="37) Boot 骨架项目" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_37-boot-骨架项目"><!---->37) Boot 骨架项目<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="38) Boot War项目" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_38-boot-war项目"><!---->38) Boot War项目<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="39) Boot 启动过程" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_39-boot-启动过程"><!---->39) Boot 启动过程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="40) Tomcat 内嵌容器" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_40-tomcat-内嵌容器"><!---->40) Tomcat 内嵌容器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="41) Boot 自动配置" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_41-boot-自动配置"><!---->41) Boot 自动配置<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="42) 条件装配底层" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_42-条件装配底层"><!---->42) 条件装配底层<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="其它" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#其它"><!---->其它<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="43) FactoryBean" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_43-factorybean"><!---->43) FactoryBean<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="44) @Indexed 原理" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_44-indexed-原理"><!---->44) @Indexed 原理<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="45) 代理进一步理解" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_45-代理进一步理解"><!---->45) 代理进一步理解<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="46) @Value 装配底层" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_46-value-装配底层"><!---->46) @Value 装配底层<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="47) @Autowired 装配底层" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_47-autowired-装配底层"><!---->47) @Autowired 装配底层<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="48) 事件监听器" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_48-事件监听器"><!---->48) 事件监听器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="49) 事件发布器" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/Blog/interview/systemdesign/framework/spriiiiing.html#_49-事件发布器"><!---->49) 事件发布器<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a aria-label="SpringMVC" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/Blog/interview/systemdesign/framework/SpringMVC.html"><!---->SpringMVC<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="MyBatis" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/Blog/interview/systemdesign/framework/MyBatis.html"><!---->MyBatis<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="SpringBoot" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/Blog/interview/systemdesign/framework/SpringBoot.html"><!---->SpringBoot<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-database" style=""></span><span class="vp-sidebar-title">数据库</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-solid fa-computer" style=""></span><span class="vp-sidebar-title">计算机基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><img class="icon" src="/Blog/assets/icon/data_16.svg" no-view style=""><span class="vp-sidebar-title">海量数据</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><span class="font-icon icon fa-fw fa-sm fa-brands fa-docker fa-sm" style=""></span><span class="vp-sidebar-title">分布式</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Spring 高级</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Vingkin</span></span><span property="author" content="Vingkin"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-09-25T15:52:09.000Z"></span><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="waline-pageview-count" data-path="/interview/systemdesign/framework/spriiiiing.html">...</span></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 50 分钟</span><meta property="timeRequired" content="PT50M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/Blog/#容器与-bean">容器与 bean</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_1-容器接口">1) 容器接口</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_2-容器实现">2) 容器实现</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_3-bean-的生命周期">3) Bean 的生命周期</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_4-bean-后处理器">4) Bean 后处理器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_5-beanfactory-后处理器">5) BeanFactory 后处理器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_6-aware-接口">6) Aware 接口</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_7-初始化与销毁">7) 初始化与销毁</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_8-scope">8) Scope</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/Blog/#aop">AOP</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_9-aop-实现之-ajc-编译器">9) AOP 实现之 ajc 编译器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_10-aop-实现之-agent-类加载">10) AOP 实现之 agent 类加载</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_11-aop-实现之-proxy">11) AOP 实现之 proxy</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_12-jdk-动态代理进阶">12) jdk 动态代理进阶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_13-cglib-代理进阶">13) cglib 代理进阶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_14-cglib-避免反射调用">14) cglib 避免反射调用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_15-jdk-和-cglib-在-spring-中的统一">15) jdk 和 cglib 在 Spring 中的统一</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_16-切点匹配">16) 切点匹配</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_17-从-aspect-到-advisor">17) 从 @Aspect 到 Advisor</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_18-静态通知调用">18) 静态通知调用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_19-动态通知调用">19) 动态通知调用</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/Blog/#web">WEB</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_20-requestmappinghandlermapping-与-requestmappinghandleradapter">20) RequestMappingHandlerMapping 与 RequestMappingHandlerAdapter</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_21-参数解析器">21) 参数解析器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_22-参数名解析">22) 参数名解析</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_23-对象绑定与类型转换">23) 对象绑定与类型转换</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_24-controlleradvice-之-initbinder">24) @ControllerAdvice 之 @InitBinder</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_25-控制器方法执行流程">25) 控制器方法执行流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_26-controlleradvice-之-modelattribute">26) @ControllerAdvice 之 @ModelAttribute</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_27-返回值处理器">27) 返回值处理器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_28-messageconverter">28) MessageConverter</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_29-controlleradvice-之-responsebodyadvice">29) @ControllerAdvice 之 ResponseBodyAdvice</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_30-异常解析器">30) 异常解析器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_31-controlleradvice-之-exceptionhandler">31) @ControllerAdvice 之 @ExceptionHandler</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_32-tomcat-异常处理">32) Tomcat 异常处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_33-beannameurlhandlermapping-与-simplecontrollerhandleradapter">33) BeanNameUrlHandlerMapping 与 SimpleControllerHandlerAdapter</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_34-routerfunctionmapping-与-handlerfunctionadapter">34) RouterFunctionMapping 与 HandlerFunctionAdapter</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_35-simpleurlhandlermapping-与-httprequesthandleradapter">35) SimpleUrlHandlerMapping 与 HttpRequestHandlerAdapter</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_36-mvc-处理流程">36) mvc 处理流程</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/Blog/#boot">Boot</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_37-boot-骨架项目">37) Boot 骨架项目</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_38-boot-war项目">38) Boot War项目</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_39-boot-启动过程">39) Boot 启动过程</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_40-tomcat-内嵌容器">40) Tomcat 内嵌容器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_41-boot-自动配置">41) Boot 自动配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_42-条件装配底层">42) 条件装配底层</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/Blog/#其它">其它</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_43-factorybean">43) FactoryBean</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_44-indexed-原理">44) @Indexed 原理</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_45-代理进一步理解">45) 代理进一步理解</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_46-value-装配底层">46) @Value 装配底层</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_47-autowired-装配底层">47) @Autowired 装配底层</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_48-事件监听器">48) 事件监听器</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/Blog/#_49-事件发布器">49) 事件发布器</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="容器与-bean" tabindex="-1"><a class="header-anchor" href="#容器与-bean" aria-hidden="true">#</a> 容器与 bean</h2><h3 id="_1-容器接口" tabindex="-1"><a class="header-anchor" href="#_1-容器接口" aria-hidden="true">#</a> 1) 容器接口</h3><ul><li><p>BeanFactory 接口，典型功能有：</p><ul><li>getBean</li></ul></li><li><p>ApplicationContext 接口，是 BeanFactory 的子接口。它扩展了 BeanFactory 接口的功能，如：</p><ul><li>国际化</li><li>通配符方式获取一组 Resource 资源</li><li>整合 Environment 环境（能通过它获取各种来源的配置信息）</li><li>事件发布与监听，实现组件之间的解耦</li></ul></li></ul><p>可以看到，我们课上讲的，都是 BeanFactory 提供的基本功能，ApplicationContext 中的扩展功能都没有用到。</p><h4 id="演示1-beanfactory-与-applicationcontext-的区别" tabindex="-1"><a class="header-anchor" href="#演示1-beanfactory-与-applicationcontext-的区别" aria-hidden="true">#</a> 演示1 - BeanFactory 与 ApplicationContext 的区别</h4><h5 id="代码参考" tabindex="-1"><a class="header-anchor" href="#代码参考" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a01</strong> 包</p><h4 id="收获💡" tabindex="-1"><a class="header-anchor" href="#收获💡" aria-hidden="true">#</a> 收获💡</h4><p>通过这个示例结合 debug 查看 ApplicationContext 对象的内部结构，学到：</p><ol><li><p>到底什么是 BeanFactory</p><ul><li>它是 ApplicationContext 的父接口</li><li>它才是 Spring 的核心容器, 主要的 ApplicationContext 实现都【组合】了它的功能，【组合】是指 ApplicationContext 的一个重要成员变量就是 BeanFactory</li></ul></li><li><p>BeanFactory 能干点啥</p><ul><li>表面上只有 getBean</li><li>实际上控制反转、基本的依赖注入、直至 Bean 的生命周期的各种功能，都由它的实现类提供</li><li>例子中通过反射查看了它的成员变量 singletonObjects，内部包含了所有的单例 bean</li></ul></li><li><p>ApplicationContext 比 BeanFactory 多点啥</p><ul><li>ApplicationContext 组合并扩展了 BeanFactory 的功能</li><li>国际化、通配符方式获取一组 Resource 资源、整合 Environment 环境、事件发布与监听</li><li>新学一种代码之间解耦途径，事件解耦</li></ul></li></ol><p>建议练习：完成用户注册与发送短信之间的解耦，用事件方式、和 AOP 方式分别实现</p><blockquote><p><em><strong>注意</strong></em></p><ul><li>如果 jdk &gt; 8, 运行时请添加 --add-opens java.base/java.lang=ALL-UNNAMED，这是因为这些版本的 jdk 默认不允许跨 module 反射</li><li>事件发布还可以异步，这个视频中没有展示，请自行查阅 @EnableAsync，@Async 的用法</li></ul></blockquote><h4 id="演示2-国际化" tabindex="-1"><a class="header-anchor" href="#演示2-国际化" aria-hidden="true">#</a> 演示2 - 国际化</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMessageSource</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">GenericApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span><span class="token function">registerBean</span><span class="token punctuation">(</span><span class="token string">&quot;messageSource&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MessageSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">ResourceBundleMessageSource</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceBundleMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ms<span class="token punctuation">.</span><span class="token function">setDefaultEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ms<span class="token punctuation">.</span><span class="token function">setBasename</span><span class="token punctuation">(</span><span class="token string">&quot;messages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> ms<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;hi&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token constant">ENGLISH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;hi&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token constant">CHINESE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;hi&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token constant">JAPANESE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>国际化文件均在 src/resources 目录下</p><p>messages.properties（空）</p><p>messages_en.properties</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">hi</span><span class="token punctuation">=</span><span class="token value attr-value">Hello</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>messages_ja.properties</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">hi</span><span class="token punctuation">=</span><span class="token value attr-value">こんにちは</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>messages_zh.properties</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">hi</span><span class="token punctuation">=</span><span class="token value attr-value">你好</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p><em><strong>注意</strong></em></p><ul><li>ApplicationContext 中 MessageSource bean 的名字固定为 messageSource</li><li>使用 SpringBoot 时，国际化文件名固定为 messages</li><li>空的 messages.properties 也必须存在</li></ul></blockquote><h3 id="_2-容器实现" tabindex="-1"><a class="header-anchor" href="#_2-容器实现" aria-hidden="true">#</a> 2) 容器实现</h3><p>Spring 的发展历史较为悠久，因此很多资料还在讲解它较旧的实现，这里出于怀旧的原因，把它们都列出来，供大家参考</p><ul><li>DefaultListableBeanFactory，是 BeanFactory 最重要的实现，像<strong>控制反转</strong>和<strong>依赖注入</strong>功能，都是它来实现</li><li>ClassPathXmlApplicationContext，从类路径查找 XML 配置文件，创建容器（旧）</li><li>FileSystemXmlApplicationContext，从磁盘路径查找 XML 配置文件，创建容器（旧）</li><li>XmlWebApplicationContext，传统 SSM 整合时，基于 XML 配置文件的容器（旧）</li><li>AnnotationConfigWebApplicationContext，传统 SSM 整合时，基于 java 配置类的容器（旧）</li><li>AnnotationConfigApplicationContext，Spring boot 中非 web 环境容器（新）</li><li>AnnotationConfigServletWebServerApplicationContext，Spring boot 中 servlet web 环境容器（新）</li><li>AnnotationConfigReactiveWebServerApplicationContext，Spring boot 中 reactive web 环境容器（新）</li></ul><p>另外要注意的是，后面这些带有 ApplicationContext 的类都是 ApplicationContext 接口的实现，但它们是<strong>组合</strong>了 DefaultListableBeanFactory 的功能，并非继承而来</p><h4 id="演示1-defaultlistablebeanfactory" tabindex="-1"><a class="header-anchor" href="#演示1-defaultlistablebeanfactory" aria-hidden="true">#</a> 演示1 - DefaultListableBeanFactory</h4><h5 id="代码参考-1" tabindex="-1"><a class="header-anchor" href="#代码参考-1" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a02.TestBeanFactory</strong></p><h4 id="收获💡-1" tabindex="-1"><a class="header-anchor" href="#收获💡-1" aria-hidden="true">#</a> 收获💡</h4><ul><li>beanFactory 可以通过 registerBeanDefinition 注册一个 bean definition 对象 <ul><li>我们平时使用的配置类、xml、组件扫描等方式都是生成 bean definition 对象注册到 beanFactory 当中</li><li>bean definition 描述了这个 bean 的创建蓝图：scope 是什么、用构造还是工厂创建、初始化销毁方法是什么，等等</li></ul></li><li>beanFactory 需要手动调用 beanFactory 后处理器对它做增强 <ul><li>例如通过解析 @Bean、@ComponentScan 等注解，来补充一些 bean definition</li></ul></li><li>beanFactory 需要手动添加 bean 后处理器，以便对后续 bean 的创建过程提供增强 <ul><li>例如 @Autowired，@Resource 等注解的解析都是 bean 后处理器完成的</li><li>bean 后处理的添加顺序会对解析结果有影响，见视频中同时加 @Autowired，@Resource 的例子</li></ul></li><li>beanFactory 需要手动调用方法来初始化单例</li><li>beanFactory 需要额外设置才能解析 ${} 与 #{}</li></ul><h4 id="演示2-常见-applicationcontext-实现" tabindex="-1"><a class="header-anchor" href="#演示2-常见-applicationcontext-实现" aria-hidden="true">#</a> 演示2 - 常见 ApplicationContext 实现</h4><h5 id="代码参考-2" tabindex="-1"><a class="header-anchor" href="#代码参考-2" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a02.A02</strong></p><h4 id="收获💡-2" tabindex="-1"><a class="header-anchor" href="#收获💡-2" aria-hidden="true">#</a> 收获💡</h4><ol><li>常见的 ApplicationContext 容器实现</li><li>内嵌容器、DispatcherServlet 的创建方法、作用</li></ol><h3 id="_3-bean-的生命周期" tabindex="-1"><a class="header-anchor" href="#_3-bean-的生命周期" aria-hidden="true">#</a> 3) Bean 的生命周期</h3><p>一个受 Spring 管理的 bean，生命周期主要阶段有</p><ol><li>创建：根据 bean 的构造方法或者工厂方法来创建 bean 实例对象</li><li>依赖注入：根据 @Autowired，@Value 或其它一些手段，为 bean 的成员变量填充值、建立关系</li><li>初始化：回调各种 Aware 接口，调用对象的各种初始化方法</li><li>销毁：在容器关闭时，会销毁所有单例对象（即调用它们的销毁方法） <ul><li>prototype 对象也能够销毁，不过需要容器这边主动调用</li></ul></li></ol><p>一些资料会提到，生命周期中还有一类 bean 后处理器：BeanPostProcessor，会在 bean 的初始化的前后，提供一些扩展逻辑。但这种说法是不完整的，见下面的演示1</p><h4 id="演示1-bean-生命周期" tabindex="-1"><a class="header-anchor" href="#演示1-bean-生命周期" aria-hidden="true">#</a> 演示1 - bean 生命周期</h4><h5 id="代码参考-3" tabindex="-1"><a class="header-anchor" href="#代码参考-3" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a03</strong> 包</p><figure><img src="https://vingkin-1304361015.cos.ap-shanghai.myqcloud.com/os/20220809110503.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>创建前后的增强</p><ul><li>postProcessBeforeInstantiation <ul><li>这里返回的对象若不为 null 会替换掉原本的 bean，并且仅会走 postProcessAfterInitialization 流程</li></ul></li><li>postProcessAfterInstantiation <ul><li>这里如果返回 false 会跳过依赖注入阶段</li></ul></li></ul><p>依赖注入前的增强</p><ul><li>postProcessProperties <ul><li>如 @Autowired、@Value、@Resource</li></ul></li></ul><p>初始化前后的增强</p><ul><li>postProcessBeforeInitialization <ul><li>这里返回的对象会替换掉原本的 bean</li><li>如 @PostConstruct、@ConfigurationProperties</li></ul></li><li>postProcessAfterInitialization <ul><li>这里返回的对象会替换掉原本的 bean</li><li>如代理增强</li></ul></li></ul><p>销毁之前的增强</p><ul><li>postProcessBeforeDestruction <ul><li>如 @PreDestroy</li></ul></li></ul><h4 id="收获💡-3" tabindex="-1"><a class="header-anchor" href="#收获💡-3" aria-hidden="true">#</a> 收获💡</h4><ol><li>Spring bean 生命周期各个阶段</li><li>模板设计模式, 指大流程已经固定好了, 通过接口回调（bean 后处理器）在一些关键点前后提供扩展</li></ol><h4 id="演示2-模板方法设计模式" tabindex="-1"><a class="header-anchor" href="#演示2-模板方法设计模式" aria-hidden="true">#</a> 演示2 - 模板方法设计模式</h4><h5 id="关键代码" tabindex="-1"><a class="header-anchor" href="#关键代码" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMethodTemplate</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">addBeanPostProcessor</span><span class="token punctuation">(</span>bean <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;解析 @Autowired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">addBeanPostProcessor</span><span class="token punctuation">(</span>bean <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;解析 @Resource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 模板方法  Template Method Pattern</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyBeanFactory</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;构造 &quot;</span> <span class="token operator">+</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;依赖注入 &quot;</span> <span class="token operator">+</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// @Autowired, @Resource</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> processor <span class="token operator">:</span> processors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                processor<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;初始化 &quot;</span> <span class="token operator">+</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> bean<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanPostProcessor</span><span class="token punctuation">&gt;</span></span> processors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addBeanPostProcessor</span><span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> processor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            processors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>processor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">interface</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对依赖注入阶段的扩展</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="演示3-bean-后处理器排序" tabindex="-1"><a class="header-anchor" href="#演示3-bean-后处理器排序" aria-hidden="true">#</a> 演示3 - bean 后处理器排序</h4><h5 id="代码参考-4" tabindex="-1"><a class="header-anchor" href="#代码参考-4" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a03.TestProcessOrder</strong></p><h4 id="收获💡-4" tabindex="-1"><a class="header-anchor" href="#收获💡-4" aria-hidden="true">#</a> 收获💡</h4><ol><li>实现了 PriorityOrdered 接口的优先级最高</li><li>实现了 Ordered 接口与加了 @Order 注解的平级, 按数字升序</li><li>其它的排在最后</li></ol><h3 id="_4-bean-后处理器" tabindex="-1"><a class="header-anchor" href="#_4-bean-后处理器" aria-hidden="true">#</a> 4) Bean 后处理器</h3><h4 id="演示1-后处理器作用" tabindex="-1"><a class="header-anchor" href="#演示1-后处理器作用" aria-hidden="true">#</a> 演示1 - 后处理器作用</h4><h5 id="代码参考-5" tabindex="-1"><a class="header-anchor" href="#代码参考-5" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a04</strong> 包</p><h4 id="收获💡-5" tabindex="-1"><a class="header-anchor" href="#收获💡-5" aria-hidden="true">#</a> 收获💡</h4><ol><li>@Autowired 等注解的解析属于 bean 生命周期阶段（依赖注入, 初始化）的扩展功能，这些扩展功能由 bean 后处理器来完成</li><li>每个后处理器各自增强什么功能 <ul><li>AutowiredAnnotationBeanPostProcessor 解析 @Autowired 与 @Value</li><li>CommonAnnotationBeanPostProcessor 解析 @Resource、@PostConstruct、@PreDestroy</li><li>ConfigurationPropertiesBindingPostProcessor 解析 @ConfigurationProperties</li></ul></li><li>另外 ContextAnnotationAutowireCandidateResolver 负责获取 @Value 的值，解析 @Qualifier、泛型、@Lazy 等</li></ol><h4 id="演示2-autowired-bean-后处理器运行分析" tabindex="-1"><a class="header-anchor" href="#演示2-autowired-bean-后处理器运行分析" aria-hidden="true">#</a> 演示2 - @Autowired bean 后处理器运行分析</h4><h5 id="代码参考-6" tabindex="-1"><a class="header-anchor" href="#代码参考-6" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a04.DigInAutowired</strong></p><h4 id="收获💡-6" tabindex="-1"><a class="header-anchor" href="#收获💡-6" aria-hidden="true">#</a> 收获💡</h4><ol><li>AutowiredAnnotationBeanPostProcessor.findAutowiringMetadata 用来获取某个 bean 上加了 @Value @Autowired 的成员变量，方法参数的信息，表示为 InjectionMetadata</li><li>InjectionMetadata 可以完成依赖注入</li><li>InjectionMetadata 内部根据成员变量，方法参数封装为 DependencyDescriptor 类型</li><li>有了 DependencyDescriptor，就可以利用 beanFactory.doResolveDependency 方法进行基于类型的查找</li></ol><h3 id="_5-beanfactory-后处理器" tabindex="-1"><a class="header-anchor" href="#_5-beanfactory-后处理器" aria-hidden="true">#</a> 5) BeanFactory 后处理器</h3><h4 id="演示1-beanfactory-后处理器的作用" tabindex="-1"><a class="header-anchor" href="#演示1-beanfactory-后处理器的作用" aria-hidden="true">#</a> 演示1 - BeanFactory 后处理器的作用</h4><h5 id="代码参考-7" tabindex="-1"><a class="header-anchor" href="#代码参考-7" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a05</strong> 包</p><ul><li>ConfigurationClassPostProcessor 可以解析 <ul><li>@ComponentScan</li><li>@Bean</li><li>@Import</li><li>@ImportResource</li></ul></li><li>MapperScannerConfigurer 可以解析 <ul><li>Mapper 接口</li></ul></li></ul><h4 id="收获💡-7" tabindex="-1"><a class="header-anchor" href="#收获💡-7" aria-hidden="true">#</a> 收获💡</h4><ol><li>@ComponentScan, @Bean, @Mapper 等注解的解析属于核心容器（即 BeanFactory）的扩展功能</li><li>这些扩展功能由不同的 BeanFactory 后处理器来完成，其实主要就是补充了一些 bean 定义</li></ol><h4 id="演示2-模拟解析-componentscan" tabindex="-1"><a class="header-anchor" href="#演示2-模拟解析-componentscan" aria-hidden="true">#</a> 演示2 - 模拟解析 @ComponentScan</h4><h5 id="代码参考-8" tabindex="-1"><a class="header-anchor" href="#代码参考-8" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a05.ComponentScanPostProcessor</strong></p><h4 id="收获💡-8" tabindex="-1"><a class="header-anchor" href="#收获💡-8" aria-hidden="true">#</a> 收获💡</h4><ol><li>Spring 操作元数据的工具类 CachingMetadataReaderFactory</li><li>通过注解元数据（AnnotationMetadata）获取直接或间接标注的注解信息</li><li>通过类元数据（ClassMetadata）获取类名，AnnotationBeanNameGenerator 生成 bean 名</li><li>解析元数据是基于 ASM 技术</li></ol><h4 id="演示3-模拟解析-bean" tabindex="-1"><a class="header-anchor" href="#演示3-模拟解析-bean" aria-hidden="true">#</a> 演示3 - 模拟解析 @Bean</h4><h5 id="代码参考-9" tabindex="-1"><a class="header-anchor" href="#代码参考-9" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a05.AtBeanPostProcessor</strong></p><h4 id="收获💡-9" tabindex="-1"><a class="header-anchor" href="#收获💡-9" aria-hidden="true">#</a> 收获💡</h4><ol><li>进一步熟悉注解元数据（AnnotationMetadata）获取方法上注解信息</li></ol><h4 id="演示4-模拟解析-mapper-接口" tabindex="-1"><a class="header-anchor" href="#演示4-模拟解析-mapper-接口" aria-hidden="true">#</a> 演示4 - 模拟解析 Mapper 接口</h4><h5 id="代码参考-10" tabindex="-1"><a class="header-anchor" href="#代码参考-10" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a05.MapperPostProcessor</strong></p><h4 id="收获💡-10" tabindex="-1"><a class="header-anchor" href="#收获💡-10" aria-hidden="true">#</a> 收获💡</h4><ol><li>Mapper 接口被 Spring 管理的本质：实际是被作为 MapperFactoryBean 注册到容器中</li><li>Spring 的诡异做法，根据接口生成的 BeanDefinition 仅为根据接口名生成 bean 名</li></ol><h3 id="_6-aware-接口" tabindex="-1"><a class="header-anchor" href="#_6-aware-接口" aria-hidden="true">#</a> 6) Aware 接口</h3><h4 id="演示-aware-接口及-initializingbean-接口" tabindex="-1"><a class="header-anchor" href="#演示-aware-接口及-initializingbean-接口" aria-hidden="true">#</a> 演示 - Aware 接口及 InitializingBean 接口</h4><h5 id="代码参考-11" tabindex="-1"><a class="header-anchor" href="#代码参考-11" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a06</strong> 包</p><h4 id="收获💡-11" tabindex="-1"><a class="header-anchor" href="#收获💡-11" aria-hidden="true">#</a> 收获💡</h4><ol><li>Aware 接口提供了一种【内置】 的注入手段，例如 <ul><li>BeanNameAware 注入 bean 的名字</li><li>BeanFactoryAware 注入 BeanFactory 容器</li><li>ApplicationContextAware 注入 ApplicationContext 容器</li><li>EmbeddedValueResolverAware 注入 ${} 解析器</li></ul></li><li>InitializingBean 接口提供了一种【内置】的初始化手段</li><li>对比 <ul><li>内置的注入和初始化不受扩展功能的影响，总会被执行</li><li>而扩展功能受某些情况影响可能会失效</li><li>因此 Spring 框架内部的类常用内置注入和初始化</li></ul></li></ol><h4 id="配置类-autowired-失效分析" tabindex="-1"><a class="header-anchor" href="#配置类-autowired-失效分析" aria-hidden="true">#</a> 配置类 @Autowired 失效分析</h4><p>Java 配置类不包含 BeanFactoryPostProcessor 的情况</p><figure><img src="https://vingkin-1304361015.cos.ap-shanghai.myqcloud.com/os/20220809110602.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Java 配置类包含 BeanFactoryPostProcessor 的情况，因此要创建其中的 BeanFactoryPostProcessor 必须提前创建 Java 配置类，而此时的 BeanPostProcessor 还未准备好，导致 @Autowired 等注解失效</p><figure><img src="https://vingkin-1304361015.cos.ap-shanghai.myqcloud.com/os/20220809110628.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>对应代码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfig1</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">MyConfig1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;注入 ApplicationContext&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;初始化&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span> <span class="token comment">//  ⬅️ 注释或添加 beanFactory 后处理器对应上方两种情况</span>
    <span class="token keyword">public</span> <span class="token class-name">BeanFactoryPostProcessor</span> <span class="token function">processor1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> beanFactory <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;执行 processor1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><em><strong>注意</strong></em></p><p>解决方法：</p><ul><li>用内置依赖注入和初始化取代扩展依赖注入和初始化</li><li>用静态工厂方法代替实例工厂方法，避免工厂对象提前被创建</li></ul></blockquote><h3 id="_7-初始化与销毁" tabindex="-1"><a class="header-anchor" href="#_7-初始化与销毁" aria-hidden="true">#</a> 7) 初始化与销毁</h3><h4 id="演示-初始化销毁顺序" tabindex="-1"><a class="header-anchor" href="#演示-初始化销毁顺序" aria-hidden="true">#</a> 演示 - 初始化销毁顺序</h4><h5 id="代码参考-12" tabindex="-1"><a class="header-anchor" href="#代码参考-12" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a07</strong> 包</p><h4 id="收获💡-12" tabindex="-1"><a class="header-anchor" href="#收获💡-12" aria-hidden="true">#</a> 收获💡</h4><p>Spring 提供了多种初始化手段，除了课堂上讲的 @PostConstruct，@Bean(initMethod) 之外，还可以实现 InitializingBean 接口来进行初始化，如果同一个 bean 用了以上手段声明了 3 个初始化方法，那么它们的执行顺序是</p><ol><li>@PostConstruct 标注的初始化方法</li><li>InitializingBean 接口的初始化方法</li><li>@Bean(initMethod) 指定的初始化方法</li></ol><p>与初始化类似，Spring 也提供了多种销毁手段，执行顺序为</p><ol><li>@PreDestroy 标注的销毁方法</li><li>DisposableBean 接口的销毁方法</li><li>@Bean(destroyMethod) 指定的销毁方法</li></ol><h3 id="_8-scope" tabindex="-1"><a class="header-anchor" href="#_8-scope" aria-hidden="true">#</a> 8) Scope</h3><p>在当前版本的 Spring 和 Spring Boot 程序中，支持五种 Scope</p><ul><li>singleton，容器启动时创建（未设置延迟），容器关闭时销毁</li><li>prototype，每次使用时创建，不会自动销毁，需要调用 DefaultListableBeanFactory.destroyBean(bean) 销毁</li><li>request，每次请求用到此 bean 时创建，请求结束时销毁</li><li>session，每个会话用到此 bean 时创建，会话结束时销毁</li><li>application，web 容器用到此 bean 时创建，容器停止时销毁</li></ul><p>有些文章提到有 globalSession 这一 Scope，也是陈旧的说法，目前 Spring 中已废弃</p><p>但要注意，如果在 singleton 注入其它 scope 都会有问题，解决方法有</p><ul><li>@Lazy</li><li>@Scope(proxyMode = ScopedProxyMode.TARGET_CLASS)</li><li>ObjectFactory</li><li>ApplicationContext.getBean</li></ul><h4 id="演示1-request-session-application-作用域" tabindex="-1"><a class="header-anchor" href="#演示1-request-session-application-作用域" aria-hidden="true">#</a> 演示1 - request, session, application 作用域</h4><h5 id="代码参考-13" tabindex="-1"><a class="header-anchor" href="#代码参考-13" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a08</strong> 包</p><ul><li>打开不同的浏览器, 刷新 <a href="http://localhost:8080/test" target="_blank" rel="noopener noreferrer">http://localhost:8080/test<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 即可查看效果</li><li>如果 jdk &gt; 8, 运行时请添加 --add-opens java.base/java.lang=ALL-UNNAMED</li></ul><h4 id="收获💡-13" tabindex="-1"><a class="header-anchor" href="#收获💡-13" aria-hidden="true">#</a> 收获💡</h4><ol><li>有几种 scope</li><li>在 singleton 中使用其它几种 scope 的方法</li><li>其它 scope 的销毁时机 <ul><li>可以将通过 server.servlet.session.timeout=30s 观察 session bean 的销毁</li><li>ServletContextScope 销毁机制疑似实现有误</li></ul></li></ol><h4 id="分析-singleton-注入其它-scope-失效" tabindex="-1"><a class="header-anchor" href="#分析-singleton-注入其它-scope-失效" aria-hidden="true">#</a> 分析 - singleton 注入其它 scope 失效</h4><p>以单例注入多例为例</p><p>有一个单例对象 E</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">E</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">F</span> f<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">E</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;E()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setF</span><span class="token punctuation">(</span><span class="token class-name">F</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>f <span class="token operator">=</span> f<span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;setF(F f) {}&quot;</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">F</span> <span class="token function">getF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> f<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要注入的对象 F 期望是多例</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">&quot;prototype&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">F</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">F</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;F()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">E</span> e <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">F</span> f1 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">F</span> f2 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>com.itheima.demo.cycle.F@6622fc65
com.itheima.demo.cycle.F@6622fc65
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>发现它们是同一个对象，而不是期望的多例对象</p><p>对于单例对象来讲，依赖注入仅发生了一次，后续再没有用到多例的 F，因此 E 用的始终是第一次依赖注入的 F</p><figure><img src="https://vingkin-1304361015.cos.ap-shanghai.myqcloud.com/os/20220809110704.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>解决</p><ul><li>仍然使用 @Lazy 生成代理</li><li>代理对象虽然还是同一个，但当每次<strong>使用代理对象的任意方法</strong>时，由代理创建新的 f 对象</li><li><img src="https://vingkin-1304361015.cos.ap-shanghai.myqcloud.com/os/20220809110738.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">E</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Lazy</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setF</span><span class="token punctuation">(</span><span class="token class-name">F</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>f <span class="token operator">=</span> f<span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;setF(F f) {}&quot;</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><em><strong>注意</strong></em></p><ul><li>@Lazy 加在也可以加在成员变量上，但加在 set 方法上的目的是可以观察输出，加在成员变量上就不行了</li><li>@Autowired 加在 set 方法的目的类似</li></ul></blockquote><p>输出</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>E: setF(F f) class com.itheima.demo.cycle.F$$EnhancerBySpringCGLIB$$8b54f2bc
F: F()
com.itheima.demo.cycle.F@3a6f2de3
F: F()
com.itheima.demo.cycle.F@56303b57
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从输出日志可以看到调用 setF 方法时，f 对象的类型是代理类型</p><h4 id="演示2-4种解决方法" tabindex="-1"><a class="header-anchor" href="#演示2-4种解决方法" aria-hidden="true">#</a> 演示2 - 4种解决方法</h4><h5 id="代码参考-14" tabindex="-1"><a class="header-anchor" href="#代码参考-14" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a08.sub</strong> 包</p><ul><li>如果 jdk &gt; 8, 运行时请添加 --add-opens java.base/java.lang=ALL-UNNAMED</li></ul><h4 id="收获💡-14" tabindex="-1"><a class="header-anchor" href="#收获💡-14" aria-hidden="true">#</a> 收获💡</h4><ol><li>单例注入其它 scope 的四种解决方法 <ul><li>@Lazy</li><li>@Scope(value = &quot;prototype&quot;, proxyMode = ScopedProxyMode.TARGET_CLASS)</li><li>ObjectFactory</li><li>ApplicationContext</li></ul></li><li>解决方法虽然不同，但理念上殊途同归: 都是推迟其它 scope bean 的获取</li></ol><h2 id="aop" tabindex="-1"><a class="header-anchor" href="#aop" aria-hidden="true">#</a> AOP</h2><p>AOP 底层实现方式之一是代理，由代理结合通知和目标，提供增强功能</p><p>除此以外，aspectj 提供了两种另外的 AOP 底层实现：</p><ul><li><p>第一种是通过 ajc 编译器在<strong>编译</strong> class 类文件时，就把通知的增强功能，织入到目标类的字节码中</p></li><li><p>第二种是通过 agent 在<strong>加载</strong>目标类时，修改目标类的字节码，织入增强功能</p></li><li><p>作为对比，之前学习的代理是<strong>运行</strong>时生成新的字节码</p></li></ul><p>简单比较的话：</p><ul><li>aspectj 在编译和加载时，修改目标字节码，性能较高</li><li>aspectj 因为不用代理，能突破一些技术上的限制，例如对构造、对静态方法、对 final 也能增强</li><li>但 aspectj 侵入性较强，且需要学习新的 aspectj 特有语法，因此没有广泛流行</li></ul><h3 id="_9-aop-实现之-ajc-编译器" tabindex="-1"><a class="header-anchor" href="#_9-aop-实现之-ajc-编译器" aria-hidden="true">#</a> 9) AOP 实现之 ajc 编译器</h3><p>代码参考项目 <strong>demo6_advanced_aspectj_01</strong></p><h4 id="收获💡-15" tabindex="-1"><a class="header-anchor" href="#收获💡-15" aria-hidden="true">#</a> 收获💡</h4><ol><li>编译器也能修改 class 实现增强</li><li>编译器增强能突破代理仅能通过方法重写增强的限制：可以对构造方法、静态方法等实现增强</li></ol><blockquote><p><em><strong>注意</strong></em></p><ul><li>版本选择了 java 8, 因为目前的 aspectj-maven-plugin 1.14.0 最高只支持到 java 16</li><li>一定要用 maven 的 compile 来编译, idea 不会调用 ajc 编译器</li></ul></blockquote><h3 id="_10-aop-实现之-agent-类加载" tabindex="-1"><a class="header-anchor" href="#_10-aop-实现之-agent-类加载" aria-hidden="true">#</a> 10) AOP 实现之 agent 类加载</h3><p>代码参考项目 <strong>demo6_advanced_aspectj_02</strong></p><h4 id="收获💡-16" tabindex="-1"><a class="header-anchor" href="#收获💡-16" aria-hidden="true">#</a> 收获💡</h4><ol><li>类加载时可以通过 agent 修改 class 实现增强</li></ol><h3 id="_11-aop-实现之-proxy" tabindex="-1"><a class="header-anchor" href="#_11-aop-实现之-proxy" aria-hidden="true">#</a> 11) AOP 实现之 proxy</h3><h4 id="演示1-jdk-动态代理" tabindex="-1"><a class="header-anchor" href="#演示1-jdk-动态代理" aria-hidden="true">#</a> 演示1 - jdk 动态代理</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdkProxyDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">interface</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Target</span> <span class="token keyword">implements</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;target foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 目标对象</span>
        <span class="token class-name">Target</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 代理对象</span>
        <span class="token class-name">Foo</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Foo</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                <span class="token class-name">Target</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>p<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy before...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy after...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用代理</span>
        proxy<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>proxy before...
target foo
proxy after...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-17" tabindex="-1"><a class="header-anchor" href="#收获💡-17" aria-hidden="true">#</a> 收获💡</h4><ul><li>jdk 动态代理要求目标<strong>必须</strong>实现接口，生成的代理类实现相同接口，因此代理与目标之间是平级兄弟关系</li></ul><h4 id="演示2-cglib-代理" tabindex="-1"><a class="header-anchor" href="#演示2-cglib-代理" aria-hidden="true">#</a> 演示2 - cglib 代理</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CglibProxyDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Target</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;target foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 目标对象</span>
        <span class="token class-name">Target</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 代理对象</span>
        <span class="token class-name">Target</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Target</span><span class="token punctuation">)</span> <span class="token class-name">Enhancer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Target</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> 
                <span class="token punctuation">(</span><span class="token class-name">MethodInterceptor</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">,</span> methodProxy<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy before...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> result <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 另一种调用方法，不需要目标对象实例</span>
<span class="token comment">//            Object result = methodProxy.invokeSuper(p, args);</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy after...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用代理</span>
        proxy<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果与 jdk 动态代理相同</p><h4 id="收获💡-18" tabindex="-1"><a class="header-anchor" href="#收获💡-18" aria-hidden="true">#</a> 收获💡</h4><ul><li>cglib 不要求目标实现接口，它生成的代理类是目标的子类，因此代理与目标之间是子父关系</li><li>限制⛔：根据上述分析 final 类无法被 cglib 增强</li></ul><h3 id="_12-jdk-动态代理进阶" tabindex="-1"><a class="header-anchor" href="#_12-jdk-动态代理进阶" aria-hidden="true">#</a> 12) jdk 动态代理进阶</h3><h4 id="演示1-模拟-jdk-动态代理" tabindex="-1"><a class="header-anchor" href="#演示1-模拟-jdk-动态代理" aria-hidden="true">#</a> 演示1 - 模拟 jdk 动态代理</h4><p>目标接口Foo.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>目标类Target.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Target</span> <span class="token keyword">implements</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>InvocationHandler接口</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代理类$Proxy0</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ⬇️这就是 jdk 代理类的源码, 秘密都在里面</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> $<span class="token class-name">Proxy0</span> <span class="token keyword">implements</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">InvocationHandler</span> h<span class="token punctuation">;</span>

    <span class="token keyword">public</span> $<span class="token class-name">Proxy0</span><span class="token punctuation">(</span><span class="token class-name">InvocationHandler</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>h <span class="token operator">=</span> h<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ⬇️3. 进入代理方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// ⬇️4. 回调 InvocationHandler</span>
            h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> foo<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> result <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> bar<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">Method</span> foo<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Method</span> bar<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            foo <span class="token operator">=</span> <span class="token class-name">A12<span class="token punctuation">.</span>Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bar <span class="token operator">=</span> <span class="token class-name">A12<span class="token punctuation">.</span>Foo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchMethodError</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $<span class="token class-name">Proxy0</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> $<span class="token class-name">Proxy0</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 发射调用目标方法</span>
                <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-19" tabindex="-1"><a class="header-anchor" href="#收获💡-19" aria-hidden="true">#</a> 收获💡</h4><p>代理一点都不难，无非就是利用了多态、反射的知识</p><ol><li>方法重写可以增强逻辑，只不过这【增强逻辑】千变万化，不能写死在代理内部</li><li>通过接口回调将【增强逻辑】置于代理类之外</li><li>配合接口方法反射（是多态调用），就可以再联动调用目标方法</li><li>会用 arthas 的 jad 工具反编译代理类</li><li>限制⛔：代理增强是借助多态来实现，因此成员变量、静态方法、final 方法均不能通过代理实现</li></ol><h4 id="演示2-方法反射优化" tabindex="-1"><a class="header-anchor" href="#演示2-方法反射优化" aria-hidden="true">#</a> 演示2 - 方法反射优化</h4><h5 id="代码参考-15" tabindex="-1"><a class="header-anchor" href="#代码参考-15" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a12.TestMethodInvoke</strong></p><h4 id="收获💡-20" tabindex="-1"><a class="header-anchor" href="#收获💡-20" aria-hidden="true">#</a> 收获💡</h4><ol><li>前 16 次反射性能较低</li><li>第 17 次调用会生成代理类，优化为非反射调用</li><li>会用 arthas 的 jad 工具反编译第 17 次调用生成的代理类</li></ol><blockquote><p><em><strong>注意</strong></em></p><p>运行时请添加 --add-opens java.base/java.lang.reflect=ALL-UNNAMED --add-opens java.base/jdk.internal.reflect=ALL-UNNAMED</p></blockquote><h3 id="_13-cglib-代理进阶" tabindex="-1"><a class="header-anchor" href="#_13-cglib-代理进阶" aria-hidden="true">#</a> 13) cglib 代理进阶</h3><h4 id="演示-模拟-cglib-代理" tabindex="-1"><a class="header-anchor" href="#演示-模拟-cglib-代理" aria-hidden="true">#</a> 演示 - 模拟 cglib 代理</h4><h5 id="代码参考-16" tabindex="-1"><a class="header-anchor" href="#代码参考-16" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a13</strong> 包</p><h4 id="收获💡-21" tabindex="-1"><a class="header-anchor" href="#收获💡-21" aria-hidden="true">#</a> 收获💡</h4><p>和 jdk 动态代理原理查不多</p><ol><li>回调的接口换了一下，InvocationHandler 改成了 MethodInterceptor</li><li>调用目标时有所改进，见下面代码片段 <ol><li>method.invoke 是反射调用，必须调用到足够次数才会进行优化</li><li>methodProxy.invoke 是不反射调用，它会正常（间接）调用目标对象的方法（Spring 采用）</li><li>methodProxy.invokeSuper 也是不反射调用，它会正常（间接）调用代理对象的方法，可以省略目标对象</li></ol></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A14Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InvocationTargetException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Target</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Proxy</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        proxy<span class="token punctuation">.</span><span class="token function">setCallbacks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token class-name">MethodInterceptor</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>p<span class="token punctuation">,</span> m<span class="token punctuation">,</span> a<span class="token punctuation">,</span> mp<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy before...&quot;</span> <span class="token operator">+</span> mp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ⬇️调用目标方法(三种)</span>
<span class="token comment">//            Object result = m.invoke(target, a);  // ⬅️反射调用</span>
<span class="token comment">//            Object result = mp.invoke(target, a); // ⬅️非反射调用, 结合目标用</span>
            <span class="token class-name">Object</span> result <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ⬅️非反射调用, 结合代理用</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;proxy after...&quot;</span> <span class="token operator">+</span> mp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ⬇️调用代理方法</span>
        proxy<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><em><strong>注意</strong></em></p><ul><li>调用 Object 的方法, 后两种在 jdk &gt;= 9 时都有问题, 需要 --add-opens java.base/java.lang=ALL-UNNAMED</li></ul></blockquote><h3 id="_14-cglib-避免反射调用" tabindex="-1"><a class="header-anchor" href="#_14-cglib-避免反射调用" aria-hidden="true">#</a> 14) cglib 避免反射调用</h3><h4 id="演示-cglib-如何避免反射" tabindex="-1"><a class="header-anchor" href="#演示-cglib-如何避免反射" aria-hidden="true">#</a> 演示 - cglib 如何避免反射</h4><h5 id="代码参考-17" tabindex="-1"><a class="header-anchor" href="#代码参考-17" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a13.ProxyFastClass</strong>，<strong>com.itheima.a13.TargetFastClass</strong></p><h4 id="收获💡-22" tabindex="-1"><a class="header-anchor" href="#收获💡-22" aria-hidden="true">#</a> 收获💡</h4><ol><li>当调用 MethodProxy 的 invoke 或 invokeSuper 方法时, 会动态生成两个类 <ul><li>ProxyFastClass 配合代理对象一起使用, 避免反射</li><li>TargetFastClass 配合目标对象一起使用, 避免反射 (Spring 用的这种)</li></ul></li><li>TargetFastClass 记录了 Target 中方法与编号的对应关系 <ul><li>save(long) 编号 2</li><li>save(int) 编号 1</li><li>save() 编号 0</li><li>首先根据方法名和参数个数、类型, 用 switch 和 if 找到这些方法编号</li><li>然后再根据编号去调用目标方法, 又用了一大堆 switch 和 if, 但避免了反射</li></ul></li><li>ProxyFastClass 记录了 Proxy 中方法与编号的对应关系，不过 Proxy 额外提供了下面几个方法 <ul><li>saveSuper(long) 编号 2，不增强，仅是调用 super.save(long)</li><li>saveSuper(int) 编号 1，不增强, 仅是调用 super.save(int)</li><li>saveSuper() 编号 0，不增强, 仅是调用 super.save()</li><li>查找方式与 TargetFastClass 类似</li></ul></li><li>为什么有这么麻烦的一套东西呢？ <ul><li>避免反射, 提高性能, 代价是一个代理类配两个 FastClass 类, 代理类中还得增加仅调用 super 的一堆方法</li><li>用编号处理方法对应关系比较省内存, 另外, 最初获得方法顺序是不确定的, 这个过程没法固定死</li></ul></li></ol><h3 id="_15-jdk-和-cglib-在-spring-中的统一" tabindex="-1"><a class="header-anchor" href="#_15-jdk-和-cglib-在-spring-中的统一" aria-hidden="true">#</a> 15) jdk 和 cglib 在 Spring 中的统一</h3><p>Spring 中对切点、通知、切面的抽象如下</p><ul><li>切点：接口 Pointcut，典型实现 AspectJExpressionPointcut</li><li>通知：典型接口为 MethodInterceptor 代表环绕通知</li><li>切面：Advisor，包含一个 Advice 通知，PointcutAdvisor 包含一个 Advice 通知和一个 Pointcut</li></ul><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p>代理相关类图</p><ul><li>AopProxyFactory 根据 proxyTargetClass 等设置选择 AopProxy 实现</li><li>AopProxy 通过 getProxy 创建代理对象</li><li>图中 Proxy 都实现了 Advised 接口，能够获得关联的切面集合与目标（其实是从 ProxyFactory 取得）</li><li>调用代理方法时，会借助 ProxyFactory 将通知统一转为环绕通知：MethodInterceptor</li></ul><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><h4 id="演示-底层切点、通知、切面" tabindex="-1"><a class="header-anchor" href="#演示-底层切点、通知、切面" aria-hidden="true">#</a> 演示 - 底层切点、通知、切面</h4><h5 id="代码参考-18" tabindex="-1"><a class="header-anchor" href="#代码参考-18" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a15.A15</strong></p><h4 id="收获💡-23" tabindex="-1"><a class="header-anchor" href="#收获💡-23" aria-hidden="true">#</a> 收获💡</h4><ol><li>底层的切点实现</li><li>底层的通知实现</li><li>底层的切面实现</li><li>ProxyFactory 用来创建代理 <ul><li>如果指定了接口，且 proxyTargetClass = false，使用 JdkDynamicAopProxy</li><li>如果没有指定接口，或者 proxyTargetClass = true，使用 ObjenesisCglibAopProxy <ul><li>例外：如果目标是接口类型或已经是 Jdk 代理，使用 JdkDynamicAopProxy</li></ul></li></ul></li></ol><blockquote><p><em><strong>注意</strong></em></p><ul><li>要区分本章节提到的 MethodInterceptor，它与之前 cglib 中用的的 MethodInterceptor 是不同的接口</li></ul></blockquote><h3 id="_16-切点匹配" tabindex="-1"><a class="header-anchor" href="#_16-切点匹配" aria-hidden="true">#</a> 16) 切点匹配</h3><h4 id="演示-切点匹配" tabindex="-1"><a class="header-anchor" href="#演示-切点匹配" aria-hidden="true">#</a> 演示 - 切点匹配</h4><h5 id="代码参考-19" tabindex="-1"><a class="header-anchor" href="#代码参考-19" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a16.A16</strong></p><h4 id="收获💡-24" tabindex="-1"><a class="header-anchor" href="#收获💡-24" aria-hidden="true">#</a> 收获💡</h4><ol><li>常见 aspectj 切点用法</li><li>aspectj 切点的局限性，实际的 @Transactional 切点实现</li></ol><h3 id="_17-从-aspect-到-advisor" tabindex="-1"><a class="header-anchor" href="#_17-从-aspect-到-advisor" aria-hidden="true">#</a> 17) 从 @Aspect 到 Advisor</h3><h4 id="演示1-代理创建器" tabindex="-1"><a class="header-anchor" href="#演示1-代理创建器" aria-hidden="true">#</a> 演示1 - 代理创建器</h4><h5 id="代码参考-20" tabindex="-1"><a class="header-anchor" href="#代码参考-20" aria-hidden="true">#</a> 代码参考</h5><p><strong>org.springframework.aop.framework.autoproxy</strong> 包</p><h4 id="收获💡-25" tabindex="-1"><a class="header-anchor" href="#收获💡-25" aria-hidden="true">#</a> 收获💡</h4><ol><li>AnnotationAwareAspectJAutoProxyCreator 的作用 <ul><li>将高级 @Aspect 切面统一为低级 Advisor 切面</li><li>在合适的时机创建代理</li></ul></li><li>findEligibleAdvisors 找到有【资格】的 Advisors <ul><li>有【资格】的 Advisor 一部分是低级的, 可以由自己编写, 如本例 A17 中的 advisor3</li><li>有【资格】的 Advisor 另一部分是高级的, 由解析 @Aspect 后获得</li></ul></li><li>wrapIfNecessary <ul><li>它内部调用 findEligibleAdvisors, 只要返回集合不空, 则表示需要创建代理</li><li>它的调用时机通常在原始对象初始化后执行, 但碰到循环依赖会提前至依赖注入之前执行</li></ul></li></ol><h4 id="演示2-代理创建时机" tabindex="-1"><a class="header-anchor" href="#演示2-代理创建时机" aria-hidden="true">#</a> 演示2 - 代理创建时机</h4><h5 id="代码参考-21" tabindex="-1"><a class="header-anchor" href="#代码参考-21" aria-hidden="true">#</a> 代码参考</h5><p><strong>org.springframework.aop.framework.autoproxy.A17_1</strong></p><h4 id="收获💡-26" tabindex="-1"><a class="header-anchor" href="#收获💡-26" aria-hidden="true">#</a> 收获💡</h4><ol><li>代理的创建时机 <ul><li>初始化之后 (无循环依赖时)</li><li>实例创建后, 依赖注入前 (有循环依赖时), 并暂存于二级缓存</li></ul></li><li>依赖注入与初始化不应该被增强, 仍应被施加于原始对象</li></ol><h4 id="演示3-before-对应的低级通知" tabindex="-1"><a class="header-anchor" href="#演示3-before-对应的低级通知" aria-hidden="true">#</a> 演示3 - @Before 对应的低级通知</h4><h5 id="代码参考-22" tabindex="-1"><a class="header-anchor" href="#代码参考-22" aria-hidden="true">#</a> 代码参考</h5><p><strong>org.springframework.aop.framework.autoproxy.A17_2</strong></p><h4 id="收获💡-27" tabindex="-1"><a class="header-anchor" href="#收获💡-27" aria-hidden="true">#</a> 收获💡</h4><ol><li>@Before 前置通知会被转换为原始的 AspectJMethodBeforeAdvice 形式, 该对象包含了如下信息 <ol><li>通知代码从哪儿来</li><li>切点是什么(这里为啥要切点, 后面解释)</li><li>通知对象如何创建, 本例共用同一个 Aspect 对象</li></ol></li><li>类似的还有 <ol><li>AspectJAroundAdvice (环绕通知)</li><li>AspectJAfterReturningAdvice</li><li>AspectJAfterThrowingAdvice (环绕通知)</li><li>AspectJAfterAdvice (环绕通知)</li></ol></li></ol><h3 id="_18-静态通知调用" tabindex="-1"><a class="header-anchor" href="#_18-静态通知调用" aria-hidden="true">#</a> 18) 静态通知调用</h3><p>代理对象调用流程如下（以 JDK 动态代理实现为例）</p><ul><li>从 ProxyFactory 获得 Target 和环绕通知链，根据他俩创建 MethodInvocation，简称 mi</li><li>首次执行 mi.proceed() 发现有下一个环绕通知，调用它的 invoke(mi)</li><li>进入环绕通知1，执行前增强，再次调用 mi.proceed() 发现有下一个环绕通知，调用它的 invoke(mi)</li><li>进入环绕通知2，执行前增强，调用 mi.proceed() 发现没有环绕通知，调用 mi.invokeJoinPoint() 执行目标方法</li><li>目标方法执行结束，将结果返回给环绕通知2，执行环绕通知2 的后增强</li><li>环绕通知2继续将结果返回给环绕通知1，执行环绕通知1 的后增强</li><li>环绕通知1返回最终的结果</li></ul><p>图中不同颜色对应一次环绕通知或目标的调用起始至终结</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><h4 id="演示1-通知调用过程" tabindex="-1"><a class="header-anchor" href="#演示1-通知调用过程" aria-hidden="true">#</a> 演示1 - 通知调用过程</h4><h5 id="代码参考-23" tabindex="-1"><a class="header-anchor" href="#代码参考-23" aria-hidden="true">#</a> 代码参考</h5><p><strong>org.springframework.aop.framework.A18</strong></p><h4 id="收获💡-28" tabindex="-1"><a class="header-anchor" href="#收获💡-28" aria-hidden="true">#</a> 收获💡</h4><p>代理方法执行时会做如下工作</p><ol><li>通过 proxyFactory 的 getInterceptorsAndDynamicInterceptionAdvice() 将其他通知统一转换为 MethodInterceptor 环绕通知 <ul><li>MethodBeforeAdviceAdapter 将 @Before AspectJMethodBeforeAdvice 适配为 MethodBeforeAdviceInterceptor</li><li>AfterReturningAdviceAdapter 将 @AfterReturning AspectJAfterReturningAdvice 适配为 AfterReturningAdviceInterceptor</li><li>这体现的是适配器设计模式</li></ul></li><li>所谓静态通知，体现在上面方法的 Interceptors 部分，这些通知调用时无需再次检查切点，直接调用即可</li><li>结合目标与环绕通知链，创建 MethodInvocation 对象，通过它完成整个调用</li></ol><h4 id="演示2-模拟-methodinvocation" tabindex="-1"><a class="header-anchor" href="#演示2-模拟-methodinvocation" aria-hidden="true">#</a> 演示2 - 模拟 MethodInvocation</h4><h5 id="代码参考-24" tabindex="-1"><a class="header-anchor" href="#代码参考-24" aria-hidden="true">#</a> 代码参考</h5><p><strong>org.springframework.aop.framework.A18_1</strong></p><h4 id="收获💡-29" tabindex="-1"><a class="header-anchor" href="#收获💡-29" aria-hidden="true">#</a> 收获💡</h4><ol><li>proceed() 方法调用链中下一个环绕通知</li><li>每个环绕通知内部继续调用 proceed()</li><li>调用到没有更多通知了, 就调用目标方法</li></ol><p>MethodInvocation 的编程技巧在实现拦截器、过滤器时能用上</p><h3 id="_19-动态通知调用" tabindex="-1"><a class="header-anchor" href="#_19-动态通知调用" aria-hidden="true">#</a> 19) 动态通知调用</h3><h4 id="演示-带参数绑定的通知方法调用" tabindex="-1"><a class="header-anchor" href="#演示-带参数绑定的通知方法调用" aria-hidden="true">#</a> 演示 - 带参数绑定的通知方法调用</h4><h5 id="代码参考-25" tabindex="-1"><a class="header-anchor" href="#代码参考-25" aria-hidden="true">#</a> 代码参考</h5><p><strong>org.springframework.aop.framework.autoproxy.A19</strong></p><h4 id="收获💡-30" tabindex="-1"><a class="header-anchor" href="#收获💡-30" aria-hidden="true">#</a> 收获💡</h4><ol><li>通过 proxyFactory 的 getInterceptorsAndDynamicInterceptionAdvice() 将其他通知统一转换为 MethodInterceptor 环绕通知</li><li>所谓动态通知，体现在上面方法的 DynamicInterceptionAdvice 部分，这些通知调用时因为要为通知方法绑定参数，还需再次利用切点表达式</li><li>动态通知调用复杂程度高，性能较低</li></ol><h2 id="web" tabindex="-1"><a class="header-anchor" href="#web" aria-hidden="true">#</a> WEB</h2><h3 id="_20-requestmappinghandlermapping-与-requestmappinghandleradapter" tabindex="-1"><a class="header-anchor" href="#_20-requestmappinghandlermapping-与-requestmappinghandleradapter" aria-hidden="true">#</a> 20) RequestMappingHandlerMapping 与 RequestMappingHandlerAdapter</h3><p>RequestMappingHandlerMapping 与 RequestMappingHandlerAdapter 俩是一对，分别用来</p><ul><li>处理 @RequestMapping 映射</li><li>调用控制器方法、并处理方法参数与方法返回值</li></ul><h4 id="演示1-dispatcherservlet-初始化" tabindex="-1"><a class="header-anchor" href="#演示1-dispatcherservlet-初始化" aria-hidden="true">#</a> 演示1 - DispatcherServlet 初始化</h4><h5 id="代码参考-26" tabindex="-1"><a class="header-anchor" href="#代码参考-26" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a20</strong> 包</p><h4 id="收获💡-31" tabindex="-1"><a class="header-anchor" href="#收获💡-31" aria-hidden="true">#</a> 收获💡</h4><ol><li>DispatcherServlet 是在第一次被访问时执行初始化, 也可以通过配置修改为 Tomcat 启动后就初始化</li><li>在初始化时会从 Spring 容器中找一些 Web 需要的组件, 如 HandlerMapping、HandlerAdapter 等，并逐一调用它们的初始化</li><li>RequestMappingHandlerMapping 初始化时，会收集所有 @RequestMapping 映射信息，封装为 Map，其中 <ul><li>key 是 RequestMappingInfo 类型，包括请求路径、请求方法等信息</li><li>value 是 HandlerMethod 类型，包括控制器方法对象、控制器对象</li><li>有了这个 Map，就可以在请求到达时，快速完成映射，找到 HandlerMethod 并与匹配的拦截器一起返回给 DispatcherServlet</li></ul></li><li>RequestMappingHandlerAdapter 初始化时，会准备 HandlerMethod 调用时需要的各个组件，如： <ul><li>HandlerMethodArgumentResolver 解析控制器方法参数</li><li>HandlerMethodReturnValueHandler 处理控制器方法返回值</li></ul></li></ol><h4 id="演示2-自定义参数与返回值处理器" tabindex="-1"><a class="header-anchor" href="#演示2-自定义参数与返回值处理器" aria-hidden="true">#</a> 演示2 - 自定义参数与返回值处理器</h4><h5 id="代码参考-27" tabindex="-1"><a class="header-anchor" href="#代码参考-27" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a20.TokenArgumentResolver</strong> ，<strong>com.itheima.a20.YmlReturnValueHandler</strong></p><h4 id="收获💡-32" tabindex="-1"><a class="header-anchor" href="#收获💡-32" aria-hidden="true">#</a> 收获💡</h4><ol><li>体会参数解析器的作用</li><li>体会返回值处理器的作用</li></ol><h3 id="_21-参数解析器" tabindex="-1"><a class="header-anchor" href="#_21-参数解析器" aria-hidden="true">#</a> 21) 参数解析器</h3><h4 id="演示-常见参数解析器" tabindex="-1"><a class="header-anchor" href="#演示-常见参数解析器" aria-hidden="true">#</a> 演示 - 常见参数解析器</h4><h5 id="代码参考-28" tabindex="-1"><a class="header-anchor" href="#代码参考-28" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a21</strong> 包</p><h4 id="收获💡-33" tabindex="-1"><a class="header-anchor" href="#收获💡-33" aria-hidden="true">#</a> 收获💡</h4><ol><li>初步了解 RequestMappingHandlerAdapter 的调用过程 <ol><li>控制器方法被封装为 HandlerMethod</li><li>准备对象绑定与类型转换</li><li>准备 ModelAndViewContainer 用来存储中间 Model 结果</li><li>解析每个参数值</li></ol></li><li>解析参数依赖的就是各种参数解析器，它们都有两个重要方法 <ul><li>supportsParameter 判断是否支持方法参数</li><li>resolveArgument 解析方法参数</li></ul></li><li>常见参数的解析 <ul><li>@RequestParam</li><li>省略 @RequestParam</li><li>@RequestParam(defaultValue)</li><li>MultipartFile</li><li>@PathVariable</li><li>@RequestHeader</li><li>@CookieValue</li><li>@Value</li><li>HttpServletRequest 等</li><li>@ModelAttribute</li><li>省略 @ModelAttribute</li><li>@RequestBody</li></ul></li><li>组合模式在 Spring 中的体现</li><li>@RequestParam, @CookieValue 等注解中的参数名、默认值, 都可以写成活的, 即从 ${ } #{ }中获取</li></ol><h3 id="_22-参数名解析" tabindex="-1"><a class="header-anchor" href="#_22-参数名解析" aria-hidden="true">#</a> 22) 参数名解析</h3><h4 id="演示-两种方法获取参数名" tabindex="-1"><a class="header-anchor" href="#演示-两种方法获取参数名" aria-hidden="true">#</a> 演示 - 两种方法获取参数名</h4><h5 id="代码参考-29" tabindex="-1"><a class="header-anchor" href="#代码参考-29" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a22.A22</strong></p><h4 id="收获💡-34" tabindex="-1"><a class="header-anchor" href="#收获💡-34" aria-hidden="true">#</a> 收获💡</h4><ol><li>如果编译时添加了 -parameters 可以生成参数表, 反射时就可以拿到参数名</li><li>如果编译时添加了 -g 可以生成调试信息, 但分为两种情况 <ul><li>普通类, 会包含局部变量表, 用 asm 可以拿到参数名</li><li>接口, 不会包含局部变量表, 无法获得参数名 <ul><li>这也是 MyBatis 在实现 Mapper 接口时为何要提供 @Param 注解来辅助获得参数名</li></ul></li></ul></li></ol><h3 id="_23-对象绑定与类型转换" tabindex="-1"><a class="header-anchor" href="#_23-对象绑定与类型转换" aria-hidden="true">#</a> 23) 对象绑定与类型转换</h3><h4 id="底层第一套转换接口与实现" tabindex="-1"><a class="header-anchor" href="#底层第一套转换接口与实现" aria-hidden="true">#</a> 底层第一套转换接口与实现</h4><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><ul><li>Printer 把其它类型转为 String</li><li>Parser 把 String 转为其它类型</li><li>Formatter 综合 Printer 与 Parser 功能</li><li>Converter 把类型 S 转为类型 T</li><li>Printer、Parser、Converter 经过适配转换成 GenericConverter 放入 Converters 集合</li><li>FormattingConversionService 利用其它们实现转换</li></ul><h4 id="底层第二套转换接口" tabindex="-1"><a class="header-anchor" href="#底层第二套转换接口" aria-hidden="true">#</a> 底层第二套转换接口</h4><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><ul><li>PropertyEditor 把 String 与其它类型相互转换</li><li>PropertyEditorRegistry 可以注册多个 PropertyEditor 对象</li><li>与第一套接口直接可以通过 FormatterPropertyEditorAdapter 来进行适配</li></ul><h4 id="高层接口与实现" tabindex="-1"><a class="header-anchor" href="#高层接口与实现" aria-hidden="true">#</a> 高层接口与实现</h4><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><ul><li>它们都实现了 TypeConverter 这个高层转换接口，在转换时，会用到 TypeConverter Delegate 委派ConversionService 与 PropertyEditorRegistry 真正执行转换（Facade 门面模式） <ul><li>首先看是否有自定义转换器, @InitBinder 添加的即属于这种 (用了适配器模式把 Formatter 转为需要的 PropertyEditor)</li><li>再看有没有 ConversionService 转换</li><li>再利用默认的 PropertyEditor 转换</li><li>最后有一些特殊处理</li></ul></li><li>SimpleTypeConverter 仅做类型转换</li><li>BeanWrapperImpl 为 bean 的属性赋值，当需要时做类型转换，走 Property</li><li>DirectFieldAccessor 为 bean 的属性赋值，当需要时做类型转换，走 Field</li><li>ServletRequestDataBinder 为 bean 的属性执行绑定，当需要时做类型转换，根据 directFieldAccess 选择走 Property 还是 Field，具备校验与获取校验结果功能</li></ul><h4 id="演示1-类型转换与数据绑定" tabindex="-1"><a class="header-anchor" href="#演示1-类型转换与数据绑定" aria-hidden="true">#</a> 演示1 - 类型转换与数据绑定</h4><h5 id="代码参考-30" tabindex="-1"><a class="header-anchor" href="#代码参考-30" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a23</strong> 包</p><h4 id="收获💡-35" tabindex="-1"><a class="header-anchor" href="#收获💡-35" aria-hidden="true">#</a> 收获💡</h4><p>基本的类型转换与数据绑定用法</p><ul><li>SimpleTypeConverter</li><li>BeanWrapperImpl</li><li>DirectFieldAccessor</li><li>ServletRequestDataBinder</li></ul><h4 id="演示2-数据绑定工厂" tabindex="-1"><a class="header-anchor" href="#演示2-数据绑定工厂" aria-hidden="true">#</a> 演示2 - 数据绑定工厂</h4><h5 id="代码参考-31" tabindex="-1"><a class="header-anchor" href="#代码参考-31" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a23.TestServletDataBinderFactory</strong></p><h4 id="收获💡-36" tabindex="-1"><a class="header-anchor" href="#收获💡-36" aria-hidden="true">#</a> 收获💡</h4><p>ServletRequestDataBinderFactory 的用法和扩展点</p><ol><li>可以解析控制器的 @InitBinder 标注方法作为扩展点，添加自定义转换器 <ul><li>控制器私有范围</li></ul></li><li>可以通过 ConfigurableWebBindingInitializer 配置 ConversionService 作为扩展点，添加自定义转换器 <ul><li>公共范围</li></ul></li><li>同时加了 @InitBinder 和 ConversionService 的转换优先级 <ol><li>优先采用 @InitBinder 的转换器</li><li>其次使用 ConversionService 的转换器</li><li>使用默认转换器</li><li>特殊处理（例如有参构造）</li></ol></li></ol><h4 id="演示3-获取泛型参数" tabindex="-1"><a class="header-anchor" href="#演示3-获取泛型参数" aria-hidden="true">#</a> 演示3 - 获取泛型参数</h4><h5 id="代码参考-32" tabindex="-1"><a class="header-anchor" href="#代码参考-32" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a23.sub</strong> 包</p><h4 id="收获💡-37" tabindex="-1"><a class="header-anchor" href="#收获💡-37" aria-hidden="true">#</a> 收获💡</h4><ol><li>java api 获取泛型参数</li><li>spring api 获取泛型参数</li></ol><h3 id="_24-controlleradvice-之-initbinder" tabindex="-1"><a class="header-anchor" href="#_24-controlleradvice-之-initbinder" aria-hidden="true">#</a> 24) @ControllerAdvice 之 @InitBinder</h3><h4 id="演示-准备-initbinder" tabindex="-1"><a class="header-anchor" href="#演示-准备-initbinder" aria-hidden="true">#</a> 演示 - 准备 @InitBinder</h4><p><strong>准备 @InitBinder</strong> 在整个 HandlerAdapter 调用过程中所处的位置</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><ul><li>RequestMappingHandlerAdapter 在图中缩写为 HandlerAdapter</li><li>HandlerMethodArgumentResolverComposite 在图中缩写为 ArgumentResolvers</li><li>HandlerMethodReturnValueHandlerComposite 在图中缩写为 ReturnValueHandlers</li></ul><h4 id="收获💡-38" tabindex="-1"><a class="header-anchor" href="#收获💡-38" aria-hidden="true">#</a> 收获💡</h4><ol><li>RequestMappingHandlerAdapter 初始化时会解析 @ControllerAdvice 中的 @InitBinder 方法</li><li>RequestMappingHandlerAdapter 会以类为单位，在该类首次使用时，解析此类的 @InitBinder 方法</li><li>以上两种 @InitBinder 的解析结果都会缓存来避免重复解析</li><li>控制器方法调用时，会综合利用本类的 @InitBinder 方法和 @ControllerAdvice 中的 @InitBinder 方法创建绑定工厂</li></ol><h3 id="_25-控制器方法执行流程" tabindex="-1"><a class="header-anchor" href="#_25-控制器方法执行流程" aria-hidden="true">#</a> 25) 控制器方法执行流程</h3><h4 id="图1" tabindex="-1"><a class="header-anchor" href="#图1" aria-hidden="true">#</a> 图1</h4><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p>HandlerMethod 需要</p><ul><li>bean 即是哪个 Controller</li><li>method 即是 Controller 中的哪个方法</li></ul><p>ServletInvocableHandlerMethod 需要</p><ul><li>WebDataBinderFactory 负责对象绑定、类型转换</li><li>ParameterNameDiscoverer 负责参数名解析</li><li>HandlerMethodArgumentResolverComposite 负责解析参数</li><li>HandlerMethodReturnValueHandlerComposite 负责处理返回值</li></ul><h4 id="图2" tabindex="-1"><a class="header-anchor" href="#图2" aria-hidden="true">#</a> 图2</h4><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><h4 id="图3" tabindex="-1"><a class="header-anchor" href="#图3" aria-hidden="true">#</a> 图3</h4><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><h3 id="_26-controlleradvice-之-modelattribute" tabindex="-1"><a class="header-anchor" href="#_26-controlleradvice-之-modelattribute" aria-hidden="true">#</a> 26) @ControllerAdvice 之 @ModelAttribute</h3><h4 id="演示-准备-modelattribute" tabindex="-1"><a class="header-anchor" href="#演示-准备-modelattribute" aria-hidden="true">#</a> 演示 - 准备 @ModelAttribute</h4><h5 id="代码参考-33" tabindex="-1"><a class="header-anchor" href="#代码参考-33" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a26</strong> 包</p><p><strong>准备 @ModelAttribute</strong> 在整个 HandlerAdapter 调用过程中所处的位置</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><h4 id="收获💡-39" tabindex="-1"><a class="header-anchor" href="#收获💡-39" aria-hidden="true">#</a> 收获💡</h4><ol><li>RequestMappingHandlerAdapter 初始化时会解析 @ControllerAdvice 中的 @ModelAttribute 方法</li><li>RequestMappingHandlerAdapter 会以类为单位，在该类首次使用时，解析此类的 @ModelAttribute 方法</li><li>以上两种 @ModelAttribute 的解析结果都会缓存来避免重复解析</li><li>控制器方法调用时，会综合利用本类的 @ModelAttribute 方法和 @ControllerAdvice 中的 @ModelAttribute 方法创建模型工厂</li></ol><h3 id="_27-返回值处理器" tabindex="-1"><a class="header-anchor" href="#_27-返回值处理器" aria-hidden="true">#</a> 27) 返回值处理器</h3><h4 id="演示-常见返回值处理器" tabindex="-1"><a class="header-anchor" href="#演示-常见返回值处理器" aria-hidden="true">#</a> 演示 - 常见返回值处理器</h4><h5 id="代码参考-34" tabindex="-1"><a class="header-anchor" href="#代码参考-34" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a27</strong> 包</p><h4 id="收获💡-40" tabindex="-1"><a class="header-anchor" href="#收获💡-40" aria-hidden="true">#</a> 收获💡</h4><ol><li>常见的返回值处理器 <ul><li>ModelAndView，分别获取其模型和视图名，放入 ModelAndViewContainer</li><li>返回值类型为 String 时，把它当做视图名，放入 ModelAndViewContainer</li><li>返回值添加了 @ModelAttribute 注解时，将返回值作为模型，放入 ModelAndViewContainer <ul><li>此时需找到默认视图名</li></ul></li><li>返回值省略 @ModelAttribute 注解且返回非简单类型时，将返回值作为模型，放入 ModelAndViewContainer <ul><li>此时需找到默认视图名</li></ul></li><li>返回值类型为 ResponseEntity 时 <ul><li>此时走 MessageConverter，并设置 ModelAndViewContainer.requestHandled 为 true</li></ul></li><li>返回值类型为 HttpHeaders 时 <ul><li>会设置 ModelAndViewContainer.requestHandled 为 true</li></ul></li><li>返回值添加了 @ResponseBody 注解时 <ul><li>此时走 MessageConverter，并设置 ModelAndViewContainer.requestHandled 为 true</li></ul></li></ul></li><li>组合模式在 Spring 中的体现 + 1</li></ol><h3 id="_28-messageconverter" tabindex="-1"><a class="header-anchor" href="#_28-messageconverter" aria-hidden="true">#</a> 28) MessageConverter</h3><h4 id="演示-messageconverter-的作用" tabindex="-1"><a class="header-anchor" href="#演示-messageconverter-的作用" aria-hidden="true">#</a> 演示 - MessageConverter 的作用</h4><h5 id="代码参考-35" tabindex="-1"><a class="header-anchor" href="#代码参考-35" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a28.A28</strong></p><h4 id="收获💡-41" tabindex="-1"><a class="header-anchor" href="#收获💡-41" aria-hidden="true">#</a> 收获💡</h4><ol><li>MessageConverter 的作用 <ul><li>@ResponseBody 是返回值处理器解析的</li><li>但具体转换工作是 MessageConverter 做的</li></ul></li><li>如何选择 MediaType <ul><li>首先看 @RequestMapping 上有没有指定</li><li>其次看 request 的 Accept 头有没有指定</li><li>最后按 MessageConverter 的顺序, 谁能谁先转换</li></ul></li></ol><h3 id="_29-controlleradvice-之-responsebodyadvice" tabindex="-1"><a class="header-anchor" href="#_29-controlleradvice-之-responsebodyadvice" aria-hidden="true">#</a> 29) @ControllerAdvice 之 ResponseBodyAdvice</h3><h4 id="演示-responsebodyadvice-增强" tabindex="-1"><a class="header-anchor" href="#演示-responsebodyadvice-增强" aria-hidden="true">#</a> 演示 - ResponseBodyAdvice 增强</h4><h5 id="代码参考-36" tabindex="-1"><a class="header-anchor" href="#代码参考-36" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a29</strong> 包</p><p><strong>ResponseBodyAdvice 增强</strong> 在整个 HandlerAdapter 调用过程中所处的位置</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><h4 id="收获💡-42" tabindex="-1"><a class="header-anchor" href="#收获💡-42" aria-hidden="true">#</a> 收获💡</h4><ol><li>ResponseBodyAdvice 返回响应体前包装</li></ol><h3 id="_30-异常解析器" tabindex="-1"><a class="header-anchor" href="#_30-异常解析器" aria-hidden="true">#</a> 30) 异常解析器</h3><h4 id="演示-exceptionhandlerexceptionresolver" tabindex="-1"><a class="header-anchor" href="#演示-exceptionhandlerexceptionresolver" aria-hidden="true">#</a> 演示 - ExceptionHandlerExceptionResolver</h4><h5 id="代码参考-37" tabindex="-1"><a class="header-anchor" href="#代码参考-37" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a30.A30</strong></p><h4 id="收获💡-43" tabindex="-1"><a class="header-anchor" href="#收获💡-43" aria-hidden="true">#</a> 收获💡</h4><ol><li>它能够重用参数解析器、返回值处理器，实现组件重用</li><li>它能够支持嵌套异常</li></ol><h3 id="_31-controlleradvice-之-exceptionhandler" tabindex="-1"><a class="header-anchor" href="#_31-controlleradvice-之-exceptionhandler" aria-hidden="true">#</a> 31) @ControllerAdvice 之 @ExceptionHandler</h3><h4 id="演示-准备-exceptionhandler" tabindex="-1"><a class="header-anchor" href="#演示-准备-exceptionhandler" aria-hidden="true">#</a> 演示 - 准备 @ExceptionHandler</h4><h5 id="代码参考-38" tabindex="-1"><a class="header-anchor" href="#代码参考-38" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a31</strong> 包</p><h4 id="收获💡-44" tabindex="-1"><a class="header-anchor" href="#收获💡-44" aria-hidden="true">#</a> 收获💡</h4><ol><li>ExceptionHandlerExceptionResolver 初始化时会解析 @ControllerAdvice 中的 @ExceptionHandler 方法</li><li>ExceptionHandlerExceptionResolver 会以类为单位，在该类首次处理异常时，解析此类的 @ExceptionHandler 方法</li><li>以上两种 @ExceptionHandler 的解析结果都会缓存来避免重复解析</li></ol><h3 id="_32-tomcat-异常处理" tabindex="-1"><a class="header-anchor" href="#_32-tomcat-异常处理" aria-hidden="true">#</a> 32) Tomcat 异常处理</h3><ul><li><p>我们知道 @ExceptionHandler 只能处理发生在 mvc 流程中的异常，例如控制器内、拦截器内，那么如果是 Filter 出现了异常，如何进行处理呢？</p></li><li><p>在 Spring Boot 中，是这么实现的：</p><ol><li>因为内嵌了 Tomcat 容器，因此可以配置 Tomcat 的错误页面，Filter 与 错误页面之间是通过请求转发跳转的，可以在这里做手脚</li><li>先通过 ErrorPageRegistrarBeanPostProcessor 这个后处理器配置错误页面地址，默认为 <code>/error</code> 也可以通过 <code>${server.error.path}</code> 进行配置</li><li>当 Filter 发生异常时，不会走 Spring 流程，但会走 Tomcat 的错误处理，于是就希望转发至 <code>/error</code> 这个地址 <ul><li>当然，如果没有 @ExceptionHandler，那么最终也会走到 Tomcat 的错误处理</li></ul></li><li>Spring Boot 又提供了一个 BasicErrorController，它就是一个标准 @Controller，@RequestMapping 配置为 <code>/error</code>，所以处理异常的职责就又回到了 Spring</li><li>异常信息由于会被 Tomcat 放入 request 作用域，因此 BasicErrorController 里也能获取到</li><li>具体异常信息会由 DefaultErrorAttributes 封装好</li><li>BasicErrorController 通过 Accept 头判断需要生成哪种 MediaType 的响应 <ul><li>如果要的不是 text/html，走 MessageConverter 流程</li><li>如果需要 text/html，走 mvc 流程，此时又分两种情况 <ul><li>配置了 ErrorViewResolver，根据状态码去找 View</li><li>没配置或没找到，用 BeanNameViewResolver 根据一个固定为 error 的名字找到 View，即所谓的 WhitelabelErrorView</li></ul></li></ul></li></ol></li></ul><blockquote><p><em><strong>评价</strong></em></p><ul><li>一个错误处理搞得这么复杂，就问恶心不？</li></ul></blockquote><h4 id="演示1-错误页处理" tabindex="-1"><a class="header-anchor" href="#演示1-错误页处理" aria-hidden="true">#</a> 演示1 - 错误页处理</h4><h5 id="关键代码-1" tabindex="-1"><a class="header-anchor" href="#关键代码-1" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span> <span class="token comment">// ⬅️修改了 Tomcat 服务器默认错误地址, 出错时使用请求转发方式跳转</span>
<span class="token keyword">public</span> <span class="token class-name">ErrorPageRegistrar</span> <span class="token function">errorPageRegistrar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> webServerFactory <span class="token operator">-&gt;</span> webServerFactory<span class="token punctuation">.</span><span class="token function">addErrorPages</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span><span class="token string">&quot;/error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span> <span class="token comment">// ⬅️TomcatServletWebServerFactory 初始化前用它增强, 注册所有 ErrorPageRegistrar</span>
<span class="token keyword">public</span> <span class="token class-name">ErrorPageRegistrarBeanPostProcessor</span> <span class="token function">errorPageRegistrarBeanPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ErrorPageRegistrarBeanPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-45" tabindex="-1"><a class="header-anchor" href="#收获💡-45" aria-hidden="true">#</a> 收获💡</h4><ol><li>Tomcat 的错误页处理手段</li></ol><h4 id="演示2-basicerrorcontroller" tabindex="-1"><a class="header-anchor" href="#演示2-basicerrorcontroller" aria-hidden="true">#</a> 演示2 - BasicErrorController</h4><h5 id="关键代码-2" tabindex="-1"><a class="header-anchor" href="#关键代码-2" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span> <span class="token comment">// ⬅️ErrorProperties 封装环境键值, ErrorAttributes 控制有哪些错误信息</span>
<span class="token keyword">public</span> <span class="token class-name">BasicErrorController</span> <span class="token function">basicErrorController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ErrorProperties</span> errorProperties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ErrorProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errorProperties<span class="token punctuation">.</span><span class="token function">setIncludeException</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BasicErrorController</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultErrorAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> errorProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span> <span class="token comment">// ⬅️名称为 error 的视图, 作为 BasicErrorController 的 text/html 响应结果</span>
<span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">render</span><span class="token punctuation">(</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">,</span> 
            <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> 
            <span class="token class-name">HttpServletResponse</span> response
        <span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">&quot;&quot;&quot;
                    &lt;h3&gt;服务器内部错误&lt;/h3&gt;
                    &quot;&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span> <span class="token comment">// ⬅️收集容器中所有 View 对象, bean 的名字作为视图名</span>
<span class="token keyword">public</span> <span class="token class-name">ViewResolver</span> <span class="token function">viewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BeanNameViewResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-46" tabindex="-1"><a class="header-anchor" href="#收获💡-46" aria-hidden="true">#</a> 收获💡</h4><ol><li>Spring Boot 中 BasicErrorController 如何工作</li></ol><h3 id="_33-beannameurlhandlermapping-与-simplecontrollerhandleradapter" tabindex="-1"><a class="header-anchor" href="#_33-beannameurlhandlermapping-与-simplecontrollerhandleradapter" aria-hidden="true">#</a> 33) BeanNameUrlHandlerMapping 与 SimpleControllerHandlerAdapter</h3><h4 id="演示-本组映射器和适配器" tabindex="-1"><a class="header-anchor" href="#演示-本组映射器和适配器" aria-hidden="true">#</a> 演示 - 本组映射器和适配器</h4><h5 id="关键代码-3" tabindex="-1"><a class="header-anchor" href="#关键代码-3" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">BeanNameUrlHandlerMapping</span> <span class="token function">beanNameUrlHandlerMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BeanNameUrlHandlerMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SimpleControllerHandlerAdapter</span> <span class="token function">simpleControllerHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleControllerHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;/c3&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Controller</span> <span class="token function">controller3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;this is c3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-47" tabindex="-1"><a class="header-anchor" href="#收获💡-47" aria-hidden="true">#</a> 收获💡</h4><ol><li>BeanNameUrlHandlerMapping，以 / 开头的 bean 的名字会被当作映射路径</li><li>这些 bean 本身当作 handler，要求实现 Controller 接口</li><li>SimpleControllerHandlerAdapter，调用 handler</li><li>模拟实现这组映射器和适配器</li></ol><h3 id="_34-routerfunctionmapping-与-handlerfunctionadapter" tabindex="-1"><a class="header-anchor" href="#_34-routerfunctionmapping-与-handlerfunctionadapter" aria-hidden="true">#</a> 34) RouterFunctionMapping 与 HandlerFunctionAdapter</h3><h4 id="演示-本组映射器和适配器-1" tabindex="-1"><a class="header-anchor" href="#演示-本组映射器和适配器-1" aria-hidden="true">#</a> 演示 - 本组映射器和适配器</h4><h5 id="关键代码-4" tabindex="-1"><a class="header-anchor" href="#关键代码-4" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">RouterFunctionMapping</span> <span class="token function">routerFunctionMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RouterFunctionMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">HandlerFunctionAdapter</span> <span class="token function">handlerFunctionAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HandlerFunctionAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">r1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//           ⬇️映射条件   ⬇️handler</span>
    <span class="token keyword">return</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request <span class="token operator">-&gt;</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">&quot;this is r1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-48" tabindex="-1"><a class="header-anchor" href="#收获💡-48" aria-hidden="true">#</a> 收获💡</h4><ol><li>RouterFunctionMapping, 通过 RequestPredicate 条件映射</li><li>handler 要实现 HandlerFunction 接口</li><li>HandlerFunctionAdapter, 调用 handler</li></ol><h3 id="_35-simpleurlhandlermapping-与-httprequesthandleradapter" tabindex="-1"><a class="header-anchor" href="#_35-simpleurlhandlermapping-与-httprequesthandleradapter" aria-hidden="true">#</a> 35) SimpleUrlHandlerMapping 与 HttpRequestHandlerAdapter</h3><h4 id="演示1-本组映射器和适配器" tabindex="-1"><a class="header-anchor" href="#演示1-本组映射器和适配器" aria-hidden="true">#</a> 演示1 - 本组映射器和适配器</h4><h5 id="代码参考-39" tabindex="-1"><a class="header-anchor" href="#代码参考-39" aria-hidden="true">#</a> 代码参考</h5><p><strong>org.springframework.boot.autoconfigure.web.servlet.A35</strong></p><h5 id="关键代码-5" tabindex="-1"><a class="header-anchor" href="#关键代码-5" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SimpleUrlHandlerMapping</span> <span class="token function">simpleUrlHandlerMapping</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SimpleUrlHandlerMapping</span> handlerMapping <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleUrlHandlerMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ResourceHttpRequestHandler</span><span class="token punctuation">&gt;</span></span> map 
        <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">ResourceHttpRequestHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    handlerMapping<span class="token punctuation">.</span><span class="token function">setUrlMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> handlerMapping<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">HttpRequestHandlerAdapter</span> <span class="token function">httpRequestHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HttpRequestHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResourceHttpRequestHandler</span> <span class="token function">handler1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResourceHttpRequestHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceHttpRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    handler<span class="token punctuation">.</span><span class="token function">setLocations</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;static/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> handler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;/img/**&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResourceHttpRequestHandler</span> <span class="token function">handler2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResourceHttpRequestHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceHttpRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    handler<span class="token punctuation">.</span><span class="token function">setLocations</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;images/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> handler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-49" tabindex="-1"><a class="header-anchor" href="#收获💡-49" aria-hidden="true">#</a> 收获💡</h4><ol><li>SimpleUrlHandlerMapping 不会在初始化时收集映射信息，需要手动收集</li><li>SimpleUrlHandlerMapping 映射路径</li><li>ResourceHttpRequestHandler 作为静态资源 handler</li><li>HttpRequestHandlerAdapter, 调用此 handler</li></ol><h4 id="演示2-静态资源解析优化" tabindex="-1"><a class="header-anchor" href="#演示2-静态资源解析优化" aria-hidden="true">#</a> 演示2 - 静态资源解析优化</h4><h5 id="关键代码-6" tabindex="-1"><a class="header-anchor" href="#关键代码-6" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResourceHttpRequestHandler</span> <span class="token function">handler1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResourceHttpRequestHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResourceHttpRequestHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    handler<span class="token punctuation">.</span><span class="token function">setLocations</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;static/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    handler<span class="token punctuation">.</span><span class="token function">setResourceResolvers</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
            <span class="token comment">// ⬇️缓存优化</span>
            <span class="token keyword">new</span> <span class="token class-name">CachingResourceResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcurrentMapCache</span><span class="token punctuation">(</span><span class="token string">&quot;cache1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// ⬇️压缩优化</span>
            <span class="token keyword">new</span> <span class="token class-name">EncodedResourceResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// ⬇️原始资源解析</span>
            <span class="token keyword">new</span> <span class="token class-name">PathResourceResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> handler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-50" tabindex="-1"><a class="header-anchor" href="#收获💡-50" aria-hidden="true">#</a> 收获💡</h4><ol><li>责任链模式体现</li><li>压缩文件需要手动生成</li></ol><h4 id="演示3-欢迎页" tabindex="-1"><a class="header-anchor" href="#演示3-欢迎页" aria-hidden="true">#</a> 演示3 - 欢迎页</h4><h5 id="关键代码-7" tabindex="-1"><a class="header-anchor" href="#关键代码-7" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">WelcomePageHandlerMapping</span> <span class="token function">welcomePageHandlerMapping</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Resource</span> resource <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:static/index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WelcomePageHandlerMapping</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> context<span class="token punctuation">,</span> resource<span class="token punctuation">,</span> <span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SimpleControllerHandlerAdapter</span> <span class="token function">simpleControllerHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleControllerHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-51" tabindex="-1"><a class="header-anchor" href="#收获💡-51" aria-hidden="true">#</a> 收获💡</h4><ol><li>欢迎页支持静态欢迎页与动态欢迎页</li><li>WelcomePageHandlerMapping 映射欢迎页（即只映射 &#39;/&#39;） <ul><li>它内置的 handler ParameterizableViewController 作用是不执行逻辑，仅根据视图名找视图</li><li>视图名固定为 forward:index.html</li></ul></li><li>SimpleControllerHandlerAdapter, 调用 handler <ul><li>转发至 /index.html</li><li>处理 /index.html 又会走上面的静态资源处理流程</li></ul></li></ol><h4 id="映射器与适配器小结" tabindex="-1"><a class="header-anchor" href="#映射器与适配器小结" aria-hidden="true">#</a> 映射器与适配器小结</h4><ol><li>HandlerMapping 负责建立请求与控制器之间的映射关系 <ul><li>RequestMappingHandlerMapping (与 @RequestMapping 匹配)</li><li>WelcomePageHandlerMapping (/)</li><li>BeanNameUrlHandlerMapping (与 bean 的名字匹配 以 / 开头)</li><li>RouterFunctionMapping (函数式 RequestPredicate, HandlerFunction)</li><li>SimpleUrlHandlerMapping (静态资源 通配符 /** /img/**)</li><li>之间也会有顺序问题, boot 中默认顺序如上</li></ul></li><li>HandlerAdapter 负责实现对各种各样的 handler 的适配调用 <ul><li>RequestMappingHandlerAdapter 处理：@RequestMapping 方法 <ul><li>参数解析器、返回值处理器体现了组合模式</li></ul></li><li>SimpleControllerHandlerAdapter 处理：Controller 接口</li><li>HandlerFunctionAdapter 处理：HandlerFunction 函数式接口</li><li>HttpRequestHandlerAdapter 处理：HttpRequestHandler 接口 (静态资源处理)</li><li>这也是典型适配器模式体现</li></ul></li></ol><h3 id="_36-mvc-处理流程" tabindex="-1"><a class="header-anchor" href="#_36-mvc-处理流程" aria-hidden="true">#</a> 36) mvc 处理流程</h3><p>当浏览器发送一个请求 <code>http://localhost:8080/hello</code> 后，请求到达服务器，其处理流程是：</p><ol><li><p>服务器提供了 DispatcherServlet，它使用的是标准 Servlet 技术</p><ul><li>路径：默认映射路径为 <code>/</code>，即会匹配到所有请求 URL，可作为请求的统一入口，也被称之为<strong>前控制器</strong><ul><li>jsp 不会匹配到 DispatcherServlet</li><li>其它有路径的 Servlet 匹配优先级也高于 DispatcherServlet</li></ul></li><li>创建：在 Boot 中，由 DispatcherServletAutoConfiguration 这个自动配置类提供 DispatcherServlet 的 bean</li><li>初始化：DispatcherServlet 初始化时会优先到容器里寻找各种组件，作为它的成员变量 <ul><li>HandlerMapping，初始化时记录映射关系</li><li>HandlerAdapter，初始化时准备参数解析器、返回值处理器、消息转换器</li><li>HandlerExceptionResolver，初始化时准备参数解析器、返回值处理器、消息转换器</li><li>ViewResolver</li></ul></li></ul></li><li><p>DispatcherServlet 会利用 RequestMappingHandlerMapping 查找控制器方法</p><ul><li><p>例如根据 /hello 路径找到 @RequestMapping(&quot;/hello&quot;) 对应的控制器方法</p></li><li><p>控制器方法会被封装为 HandlerMethod 对象，并结合匹配到的拦截器一起返回给 DispatcherServlet</p></li><li><p>HandlerMethod 和拦截器合在一起称为 HandlerExecutionChain（调用链）对象</p></li></ul></li><li><p>DispatcherServlet 接下来会：</p><ol><li>调用拦截器的 preHandle 方法</li><li>RequestMappingHandlerAdapter 调用 handle 方法，准备数据绑定工厂、模型工厂、ModelAndViewContainer、将 HandlerMethod 完善为 ServletInvocableHandlerMethod <ul><li>@ControllerAdvice 全局增强点1️⃣：补充模型数据</li><li>@ControllerAdvice 全局增强点2️⃣：补充自定义类型转换器</li><li>使用 HandlerMethodArgumentResolver 准备参数 <ul><li>@ControllerAdvice 全局增强点3️⃣：RequestBody 增强</li></ul></li><li>调用 ServletInvocableHandlerMethod</li><li>使用 HandlerMethodReturnValueHandler 处理返回值 <ul><li>@ControllerAdvice 全局增强点4️⃣：ResponseBody 增强</li></ul></li><li>根据 ModelAndViewContainer 获取 ModelAndView <ul><li>如果返回的 ModelAndView 为 null，不走第 4 步视图解析及渲染流程 <ul><li>例如，有的返回值处理器调用了 HttpMessageConverter 来将结果转换为 JSON，这时 ModelAndView 就为 null</li></ul></li><li>如果返回的 ModelAndView 不为 null，会在第 4 步走视图解析及渲染流程</li></ul></li></ul></li><li>调用拦截器的 postHandle 方法</li><li>处理异常或视图渲染 <ul><li>如果 1~3 出现异常，走 ExceptionHandlerExceptionResolver 处理异常流程 <ul><li>@ControllerAdvice 全局增强点5️⃣：@ExceptionHandler 异常处理</li></ul></li><li>正常，走视图解析及渲染流程</li></ul></li><li>调用拦截器的 afterCompletion 方法</li></ol></li></ol><h2 id="boot" tabindex="-1"><a class="header-anchor" href="#boot" aria-hidden="true">#</a> Boot</h2><h3 id="_37-boot-骨架项目" tabindex="-1"><a class="header-anchor" href="#_37-boot-骨架项目" aria-hidden="true">#</a> 37) Boot 骨架项目</h3><p>如果是 linux 环境，用以下命令即可获取 spring boot 的骨架 pom.xml</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-G</span> https://start.spring.io/pom.xml <span class="token parameter variable">-d</span> <span class="token assign-left variable">dependencies</span><span class="token operator">=</span>web,mysql,mybatis <span class="token parameter variable">-o</span> pom.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>也可以使用 Postman 等工具实现</p><p>若想获取更多用法，请参考</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> https://start.spring.io
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_38-boot-war项目" tabindex="-1"><a class="header-anchor" href="#_38-boot-war项目" aria-hidden="true">#</a> 38) Boot War项目</h3><p>步骤1：创建模块，区别在于打包方式选择 war</p><img title="" src="https://vingkin-1304361015.cos.ap-shanghai.myqcloud.com/os/image-20211021160145072.png" alt="image-20211021160145072" style="zoom:50%;"><p>接下来勾选 Spring Web 支持</p><img title="" src="https://vingkin-1304361015.cos.ap-shanghai.myqcloud.com/os/image-20211021162416525.png" alt="image-20211021162416525" style="zoom:50%;"><p>步骤2：编写控制器</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">abc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进入了控制器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>步骤3：编写 jsp 视图，新建 webapp 目录和一个 hello.jsp 文件，注意文件名与控制器方法返回的视图逻辑名一致</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>src
    |- main
        |- java
        |- resources
        |- webapp
            |- hello.jsp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>步骤4：配置视图路径，打开 application.properties 文件</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.mvc.view.prefix</span><span class="token punctuation">=</span><span class="token value attr-value">/</span>
<span class="token key attr-name">spring.mvc.view.suffix</span><span class="token punctuation">=</span><span class="token value attr-value">.jsp</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>将来 prefix + 控制器方法返回值 + suffix 即为视图完整路径</p></blockquote><h4 id="测试" tabindex="-1"><a class="header-anchor" href="#测试" aria-hidden="true">#</a> 测试</h4><p>如果用 mvn 插件 <code>mvn spring-boot:run</code> 或 main 方法测试</p><ul><li>必须添加如下依赖，因为此时用的还是内嵌 tomcat，而内嵌 tomcat 默认不带 jasper（用来解析 jsp）</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.tomcat.embed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tomcat-embed-jasper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以使用 Idea 配置 tomcat 来测试，此时用的是外置 tomcat</p><ul><li>骨架生成的代码中，多了一个 ServletInitializer，它的作用就是配置外置 Tomcat 使用的，在外置 Tomcat 启动后，去调用它创建和运行 SpringApplication</li></ul><h4 id="启示" tabindex="-1"><a class="header-anchor" href="#启示" aria-hidden="true">#</a> 启示</h4><p>对于 jar 项目，若要支持 jsp，也可以在加入 jasper 依赖的前提下，把 jsp 文件置入 <code>META-INF/resources</code></p><h3 id="_39-boot-启动过程" tabindex="-1"><a class="header-anchor" href="#_39-boot-启动过程" aria-hidden="true">#</a> 39) Boot 启动过程</h3><p>阶段一：SpringApplication 构造</p><ol><li>记录 BeanDefinition 源</li><li>推断应用类型</li><li>记录 ApplicationContext 初始化器</li><li>记录监听器</li><li>推断主启动类</li></ol><p>阶段二：执行 run 方法</p><ol><li><p>得到 SpringApplicationRunListeners，名字取得不好，实际是事件发布器</p><ul><li>发布 application starting 事件1️⃣</li></ul></li><li><p>封装启动 args</p></li><li><p>准备 Environment 添加命令行参数（*）</p></li><li><p>ConfigurationPropertySources 处理（*）</p><ul><li>发布 application environment 已准备事件2️⃣</li></ul></li><li><p>通过 EnvironmentPostProcessorApplicationListener 进行 env 后处理（*）</p><ul><li>application.properties，由 StandardConfigDataLocationResolver 解析</li><li>spring.application.json</li></ul></li><li><p>绑定 spring.main 到 SpringApplication 对象（*）</p></li><li><p>打印 banner（*）</p></li><li><p>创建容器</p></li><li><p>准备容器</p><ul><li>发布 application context 已初始化事件3️⃣</li></ul></li><li><p>加载 bean 定义</p><ul><li>发布 application prepared 事件4️⃣</li></ul></li><li><p>refresh 容器</p><ul><li>发布 application started 事件5️⃣</li></ul></li><li><p>执行 runner</p><ul><li><p>发布 application ready 事件6️⃣</p></li><li><p>这其中有异常，发布 application failed 事件7️⃣</p></li></ul></li></ol><blockquote><p>带 * 的有独立的示例</p></blockquote><h4 id="演示-启动过程" tabindex="-1"><a class="header-anchor" href="#演示-启动过程" aria-hidden="true">#</a> 演示 - 启动过程</h4><p><strong>com.itheima.a39.A39_1</strong> 对应 SpringApplication 构造</p><p><strong>com.itheima.a39.A39_2</strong> 对应第1步，并演示 7 个事件</p><p><strong>com.itheima.a39.A39_3</strong> 对应第2、8到12步</p><p><strong>org.springframework.boot.Step3</strong></p><p><strong>org.springframework.boot.Step4</strong></p><p><strong>org.springframework.boot.Step5</strong></p><p><strong>org.springframework.boot.Step6</strong></p><p><strong>org.springframework.boot.Step7</strong></p><h4 id="收获💡-52" tabindex="-1"><a class="header-anchor" href="#收获💡-52" aria-hidden="true">#</a> 收获💡</h4><ol><li>SpringApplication 构造方法中所做的操作 <ul><li>可以有多种源用来加载 bean 定义</li><li>应用类型推断</li><li>添加容器初始化器</li><li>添加监听器</li><li>演示主类推断</li></ul></li><li>如何读取 spring.factories 中的配置</li><li>从配置中获取重要的事件发布器：SpringApplicationRunListeners</li><li>容器的创建、初始化器增强、加载 bean 定义等</li><li>CommandLineRunner、ApplicationRunner 的作用</li><li>环境对象 <ol><li>命令行 PropertySource</li><li>ConfigurationPropertySources 规范环境键名称</li><li>EnvironmentPostProcessor 后处理增强 <ul><li>由 EventPublishingRunListener 通过监听事件2️⃣来调用</li></ul></li><li>绑定 spring.main 前缀的 key value 至 SpringApplication</li></ol></li><li>Banner</li></ol><h3 id="_40-tomcat-内嵌容器" tabindex="-1"><a class="header-anchor" href="#_40-tomcat-内嵌容器" aria-hidden="true">#</a> 40) Tomcat 内嵌容器</h3><p>Tomcat 基本结构</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Server
└───Service
    ├───Connector (协议, 端口)
    └───Engine
        └───Host(虚拟主机 localhost)
            ├───Context1 (应用1, 可以设置虚拟路径, / 即 url 起始路径; 项目磁盘路径, 即 docBase )
            │   │   index.html
            │   └───WEB-INF
            │       │   web.xml (servlet, filter, listener) 3.0
            │       ├───classes (servlet, controller, service ...)
            │       ├───jsp
            │       └───lib (第三方 jar 包)
            └───Context2 (应用2)
                │   index.html
                └───WEB-INF
                        web.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="演示1-tomcat-内嵌容器" tabindex="-1"><a class="header-anchor" href="#演示1-tomcat-内嵌容器" aria-hidden="true">#</a> 演示1 - Tomcat 内嵌容器</h4><h5 id="关键代码-8" tabindex="-1"><a class="header-anchor" href="#关键代码-8" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.创建 Tomcat 对象</span>
    <span class="token class-name">Tomcat</span> tomcat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tomcat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">setBaseDir</span><span class="token punctuation">(</span><span class="token string">&quot;tomcat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.创建项目文件夹, 即 docBase 文件夹</span>
    <span class="token class-name">File</span> docBase <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">createTempDirectory</span><span class="token punctuation">(</span><span class="token string">&quot;boot.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    docBase<span class="token punctuation">.</span><span class="token function">deleteOnExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.创建 Tomcat 项目, 在 Tomcat 中称为 Context</span>
    <span class="token class-name">Context</span> context <span class="token operator">=</span> tomcat<span class="token punctuation">.</span><span class="token function">addContext</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> docBase<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4.编程添加 Servlet</span>
    context<span class="token punctuation">.</span><span class="token function">addServletContainerInitializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletContainerInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStartup</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">,</span> <span class="token class-name">ServletContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
            <span class="token class-name">HelloServlet</span> helloServlet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">addServlet</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">,</span> helloServlet<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5.启动 Tomcat</span>
    tomcat<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 6.创建连接器, 设置监听端口</span>
    <span class="token class-name">Connector</span> connector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connector</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Http11Nio2Protocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connector<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">setConnector</span><span class="token punctuation">(</span>connector<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="演示2-集成-spring-容器" tabindex="-1"><a class="header-anchor" href="#演示2-集成-spring-容器" aria-hidden="true">#</a> 演示2 - 集成 Spring 容器</h4><h5 id="关键代码-9" tabindex="-1"><a class="header-anchor" href="#关键代码-9" aria-hidden="true">#</a> 关键代码</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">WebApplicationContext</span> springContext <span class="token operator">=</span> <span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4.编程添加 Servlet</span>
context<span class="token punctuation">.</span><span class="token function">addServletContainerInitializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletContainerInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStartup</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">,</span> <span class="token class-name">ServletContext</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token comment">// ⬇️通过 ServletRegistrationBean 添加 DispatcherServlet 等</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ServletRegistrationBean</span> registrationBean <span class="token operator">:</span> 
             springContext<span class="token punctuation">.</span><span class="token function">getBeansOfType</span><span class="token punctuation">(</span><span class="token class-name">ServletRegistrationBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            registrationBean<span class="token punctuation">.</span><span class="token function">onStartup</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_41-boot-自动配置" tabindex="-1"><a class="header-anchor" href="#_41-boot-自动配置" aria-hidden="true">#</a> 41) Boot 自动配置</h3><h4 id="aopautoconfiguration" tabindex="-1"><a class="header-anchor" href="#aopautoconfiguration" aria-hidden="true">#</a> AopAutoConfiguration</h4><p>Spring Boot 是利用了自动配置类来简化了 aop 相关配置</p><ul><li>AOP 自动配置类为 <code>org.springframework.boot.autoconfigure.aop.AopAutoConfiguration</code></li><li>可以通过 <code>spring.aop.auto=false</code> 禁用 aop 自动配置</li><li>AOP 自动配置的本质是通过 <code>@EnableAspectJAutoProxy</code> 来开启了自动代理，如果在引导类上自己添加了 <code>@EnableAspectJAutoProxy</code> 那么以自己添加的为准</li><li><code>@EnableAspectJAutoProxy</code> 的本质是向容器中添加了 <code>AnnotationAwareAspectJAutoProxyCreator</code> 这个 bean 后处理器，它能够找到容器中所有切面，并为匹配切点的目标类创建代理，创建代理的工作一般是在 bean 的初始化阶段完成的</li></ul><h4 id="datasourceautoconfiguration" tabindex="-1"><a class="header-anchor" href="#datasourceautoconfiguration" aria-hidden="true">#</a> DataSourceAutoConfiguration</h4><ul><li>对应的自动配置类为：org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</li><li>它内部采用了条件装配，通过检查容器的 bean，以及类路径下的 class，来决定该 @Bean 是否生效</li></ul><p>简单说明一下，Spring Boot 支持两大类数据源：</p><ul><li>EmbeddedDatabase - 内嵌数据库连接池</li><li>PooledDataSource - 非内嵌数据库连接池</li></ul><p>PooledDataSource 又支持如下数据源</p><ul><li>hikari 提供的 HikariDataSource</li><li>tomcat-jdbc 提供的 DataSource</li><li>dbcp2 提供的 BasicDataSource</li><li>oracle 提供的 PoolDataSourceImpl</li></ul><p>如果知道数据源的实现类类型，即指定了 <code>spring.datasource.type</code>，理论上可以支持所有数据源，但这样做的一个最大问题是无法订制每种数据源的详细配置（如最大、最小连接数等）</p><h4 id="mybatisautoconfiguration" tabindex="-1"><a class="header-anchor" href="#mybatisautoconfiguration" aria-hidden="true">#</a> MybatisAutoConfiguration</h4><ul><li>MyBatis 自动配置类为 <code>org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration</code></li><li>它主要配置了两个 bean <ul><li>SqlSessionFactory - MyBatis 核心对象，用来创建 SqlSession</li><li>SqlSessionTemplate - SqlSession 的实现，此实现会与当前线程绑定</li><li>用 ImportBeanDefinitionRegistrar 的方式扫描所有标注了 @Mapper 注解的接口</li><li>用 AutoConfigurationPackages 来确定扫描的包</li></ul></li><li>还有一个相关的 bean：MybatisProperties，它会读取配置文件中带 <code>mybatis.</code> 前缀的配置项进行定制配置</li></ul><p>@MapperScan 注解的作用与 MybatisAutoConfiguration 类似，会注册 MapperScannerConfigurer 有如下区别</p><ul><li>@MapperScan 扫描具体包（当然也可以配置关注哪个注解）</li><li>@MapperScan 如果不指定扫描具体包，则会把引导类范围内，所有接口当做 Mapper 接口</li><li>MybatisAutoConfiguration 关注的是所有标注 @Mapper 注解的接口，会忽略掉非 @Mapper 标注的接口</li></ul><p>这里有同学有疑问，之前介绍的都是将具体类交给 Spring 管理，怎么到了 MyBatis 这儿，接口就可以被管理呢？</p><ul><li>其实并非将接口交给 Spring 管理，而是每个接口会对应一个 MapperFactoryBean，是后者被 Spring 所管理，接口只是作为 MapperFactoryBean 的一个属性来配置</li></ul><h4 id="transactionautoconfiguration" tabindex="-1"><a class="header-anchor" href="#transactionautoconfiguration" aria-hidden="true">#</a> TransactionAutoConfiguration</h4><ul><li><p>事务自动配置类有两个：</p><ul><li><code>org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration</code></li><li><code>org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration</code></li></ul></li><li><p>前者配置了 DataSourceTransactionManager 用来执行事务的提交、回滚操作</p></li><li><p>后者功能上对标 @EnableTransactionManagement，包含以下三个 bean</p><ul><li>BeanFactoryTransactionAttributeSourceAdvisor 事务切面类，包含通知和切点</li><li>TransactionInterceptor 事务通知类，由它在目标方法调用前后加入事务操作</li><li>AnnotationTransactionAttributeSource 会解析 @Transactional 及事务属性，也包含了切点功能</li></ul></li><li><p>如果自己配置了 DataSourceTransactionManager 或是在引导类加了 @EnableTransactionManagement，则以自己配置的为准</p></li></ul><h4 id="servletwebserverfactoryautoconfiguration" tabindex="-1"><a class="header-anchor" href="#servletwebserverfactoryautoconfiguration" aria-hidden="true">#</a> ServletWebServerFactoryAutoConfiguration</h4><ul><li>提供 ServletWebServerFactory</li></ul><h4 id="dispatcherservletautoconfiguration" tabindex="-1"><a class="header-anchor" href="#dispatcherservletautoconfiguration" aria-hidden="true">#</a> DispatcherServletAutoConfiguration</h4><ul><li>提供 DispatcherServlet</li><li>提供 DispatcherServletRegistrationBean</li></ul><h4 id="webmvcautoconfiguration" tabindex="-1"><a class="header-anchor" href="#webmvcautoconfiguration" aria-hidden="true">#</a> WebMvcAutoConfiguration</h4><ul><li>配置 DispatcherServlet 的各项组件，提供的 bean 见过的有 <ul><li>多项 HandlerMapping</li><li>多项 HandlerAdapter</li><li>HandlerExceptionResolver</li></ul></li></ul><h4 id="errormvcautoconfiguration" tabindex="-1"><a class="header-anchor" href="#errormvcautoconfiguration" aria-hidden="true">#</a> ErrorMvcAutoConfiguration</h4><ul><li>提供的 bean 有 BasicErrorController</li></ul><h4 id="multipartautoconfiguration" tabindex="-1"><a class="header-anchor" href="#multipartautoconfiguration" aria-hidden="true">#</a> MultipartAutoConfiguration</h4><ul><li>它提供了 org.springframework.web.multipart.support.StandardServletMultipartResolver</li><li>该 bean 用来解析 multipart/form-data 格式的数据</li></ul><h4 id="httpencodingautoconfiguration" tabindex="-1"><a class="header-anchor" href="#httpencodingautoconfiguration" aria-hidden="true">#</a> HttpEncodingAutoConfiguration</h4><ul><li>POST 请求参数如果有中文，无需特殊设置，这是因为 Spring Boot 已经配置了 org.springframework.boot.web.servlet.filter.OrderedCharacterEncodingFilter</li><li>对应配置 server.servlet.encoding.charset=UTF-8，默认就是 UTF-8</li><li>当然，它只影响非 json 格式的数据</li></ul><h4 id="演示-自动配置类原理" tabindex="-1"><a class="header-anchor" href="#演示-自动配置类原理" aria-hidden="true">#</a> 演示 - 自动配置类原理</h4><h5 id="关键代码-10" tabindex="-1"><a class="header-anchor" href="#关键代码-10" aria-hidden="true">#</a> 关键代码</h5><p>假设已有第三方的两个自动配置类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span> <span class="token comment">// ⬅️第三方的配置类</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AutoConfiguration1</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Bean1</span> <span class="token function">bean1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Bean1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Configuration</span> <span class="token comment">// ⬅️第三方的配置类</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AutoConfiguration2</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Bean2</span> <span class="token function">bean2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Bean2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>提供一个配置文件 META-INF/spring.factories，key 为导入器类名，值为多个自动配置类名，用逗号分隔</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">MyImportSelector</span><span class="token punctuation">=</span><span class="token value attr-value">\
AutoConfiguration1,\
AutoConfiguration2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><em><strong>注意</strong></em></p><ul><li>上述配置文件中 MyImportSelector 与 AutoConfiguration1，AutoConfiguration2 为简洁均省略了包名，自己测试时请将包名根据情况补全</li></ul></blockquote><p>引入自动配置</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span> <span class="token comment">// ⬅️本项目的配置类</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">MyImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">DeferredImportSelector</span> <span class="token punctuation">{</span>
    <span class="token comment">// ⬇️该方法从 META-INF/spring.factories 读取自动配置类名，返回的 String[] 即为要导入的配置类</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SpringFactoriesLoader</span>
            <span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token class-name">MyImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-53" tabindex="-1"><a class="header-anchor" href="#收获💡-53" aria-hidden="true">#</a> 收获💡</h4><ol><li>自动配置类本质上就是一个配置类而已，只是用 META-INF/spring.factories 管理，与应用配置类解耦</li><li>@Enable 打头的注解本质是利用了 @Import</li><li>@Import 配合 DeferredImportSelector 即可实现导入，selectImports 方法的返回值即为要导入的配置类名</li><li>DeferredImportSelector 的导入会在最后执行，为的是让其它配置优先解析</li></ol><h3 id="_42-条件装配底层" tabindex="-1"><a class="header-anchor" href="#_42-条件装配底层" aria-hidden="true">#</a> 42) 条件装配底层</h3><p>条件装配的底层是本质上是 @Conditional 与 Condition，这两个注解。引入自动配置类时，期望满足一定条件才能被 Spring 管理，不满足则不管理，怎么做呢？</p><p>比如条件是【类路径下必须有 dataSource】这个 bean ，怎么做呢？</p><p>首先编写条件判断类，它实现 Condition 接口，编写条件判断逻辑</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyCondition1</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span> 
    <span class="token comment">// ⬇️如果存在 Druid 依赖，条件成立</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其次，在要导入的自动配置类上添加 <code>@Conditional(MyCondition1.class)</code>，将来此类被导入时就会做条件检查</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span> <span class="token comment">// 第三方的配置类</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">MyCondition1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// ⬅️加入条件</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AutoConfiguration1</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Bean1</span> <span class="token function">bean1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Bean1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分别测试加入和去除 druid 依赖，观察 bean1 是否存在于容器</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="收获💡-54" tabindex="-1"><a class="header-anchor" href="#收获💡-54" aria-hidden="true">#</a> 收获💡</h4><ol><li>学习一种特殊的 if - else</li></ol><h2 id="其它" tabindex="-1"><a class="header-anchor" href="#其它" aria-hidden="true">#</a> 其它</h2><h3 id="_43-factorybean" tabindex="-1"><a class="header-anchor" href="#_43-factorybean" aria-hidden="true">#</a> 43) FactoryBean</h3><h4 id="演示-factorybean" tabindex="-1"><a class="header-anchor" href="#演示-factorybean" aria-hidden="true">#</a> 演示 - FactoryBean</h4><h5 id="代码参考-40" tabindex="-1"><a class="header-anchor" href="#代码参考-40" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a43</strong> 包</p><h4 id="收获💡-55" tabindex="-1"><a class="header-anchor" href="#收获💡-55" aria-hidden="true">#</a> 收获💡</h4><ol><li>它的作用是用制造创建过程较为复杂的产品, 如 SqlSessionFactory, 但 @Bean 已具备等价功能</li><li>使用上较为古怪, 一不留神就会用错 <ol><li>被 FactoryBean 创建的产品 <ul><li>会认为创建、依赖注入、Aware 接口回调、前初始化这些都是 FactoryBean 的职责, 这些流程都不会走</li><li>唯有后初始化的流程会走, 也就是产品可以被代理增强</li><li>单例的产品不会存储于 BeanFactory 的 singletonObjects 成员中, 而是另一个 factoryBeanObjectCache 成员中</li></ul></li><li>按名字去获取时, 拿到的是产品对象, 名字前面加 &amp; 获取的是工厂对象</li></ol></li></ol><h3 id="_44-indexed-原理" tabindex="-1"><a class="header-anchor" href="#_44-indexed-原理" aria-hidden="true">#</a> 44) @Indexed 原理</h3><p>真实项目中，只需要加入以下依赖即可</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context-indexer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="演示-indexed" tabindex="-1"><a class="header-anchor" href="#演示-indexed" aria-hidden="true">#</a> 演示 - @Indexed</h4><h5 id="代码参考-41" tabindex="-1"><a class="header-anchor" href="#代码参考-41" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a44</strong> 包</p><h4 id="收获💡-56" tabindex="-1"><a class="header-anchor" href="#收获💡-56" aria-hidden="true">#</a> 收获💡</h4><ol><li>在编译时就根据 @Indexed 生成 META-INF/spring.components 文件</li><li>扫描时 <ul><li>如果发现 META-INF/spring.components 存在, 以它为准加载 bean definition</li><li>否则, 会遍历包下所有 class 资源 (包括 jar 内的)</li></ul></li><li>解决的问题，在编译期就找到 @Component 组件，节省运行期间扫描 @Component 的时间</li></ol><h3 id="_45-代理进一步理解" tabindex="-1"><a class="header-anchor" href="#_45-代理进一步理解" aria-hidden="true">#</a> 45) 代理进一步理解</h3><h4 id="演示-代理" tabindex="-1"><a class="header-anchor" href="#演示-代理" aria-hidden="true">#</a> 演示 - 代理</h4><h5 id="代码参考-42" tabindex="-1"><a class="header-anchor" href="#代码参考-42" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a45</strong> 包</p><h4 id="收获💡-57" tabindex="-1"><a class="header-anchor" href="#收获💡-57" aria-hidden="true">#</a> 收获💡</h4><ol><li><p>spring 代理的设计特点</p><ul><li><p>依赖注入和初始化影响的是原始对象</p><ul><li>因此 cglib 不能用 MethodProxy.invokeSuper()</li></ul></li><li><p>代理与目标是两个对象，二者成员变量并不共用数据</p></li></ul></li><li><p>static 方法、final 方法、private 方法均无法增强</p><ul><li>进一步理解代理增强基于方法重写</li></ul></li></ol><h3 id="_46-value-装配底层" tabindex="-1"><a class="header-anchor" href="#_46-value-装配底层" aria-hidden="true">#</a> 46) @Value 装配底层</h3><h4 id="按类型装配的步骤" tabindex="-1"><a class="header-anchor" href="#按类型装配的步骤" aria-hidden="true">#</a> 按类型装配的步骤</h4><ol><li>查看需要的类型是否为 Optional，是，则进行封装（非延迟），否则向下走</li><li>查看需要的类型是否为 ObjectFactory 或 ObjectProvider，是，则进行封装（延迟），否则向下走</li><li>查看需要的类型（成员或参数）上是否用 @Lazy 修饰，是，则返回代理，否则向下走</li><li>解析 @Value 的值 <ol><li>如果需要的值是字符串，先解析 ${ }，再解析 #</li><li>不是字符串，需要用 TypeConverter 转换</li></ol></li><li>看需要的类型是否为 Stream、Array、Collection、Map，是，则按集合处理，否则向下走</li><li>在 BeanFactory 的 resolvableDependencies 中找有没有类型合适的对象注入，没有向下走</li><li>在 BeanFactory 及父工厂中找类型匹配的 bean 进行筛选，筛选时会考虑 @Qualifier 及泛型</li><li>结果个数为 0 抛出 NoSuchBeanDefinitionException 异常</li><li>如果结果 &gt; 1，再根据 @Primary 进行筛选</li><li>如果结果仍 &gt; 1，再根据成员名或变量名进行筛选</li><li>结果仍 &gt; 1，抛出 NoUniqueBeanDefinitionException 异常</li></ol><h4 id="演示-value-装配过程" tabindex="-1"><a class="header-anchor" href="#演示-value-装配过程" aria-hidden="true">#</a> 演示 - @Value 装配过程</h4><h5 id="代码参考-43" tabindex="-1"><a class="header-anchor" href="#代码参考-43" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a46</strong> 包</p><h4 id="收获💡-58" tabindex="-1"><a class="header-anchor" href="#收获💡-58" aria-hidden="true">#</a> 收获💡</h4><ol><li>ContextAnnotationAutowireCandidateResolver 作用之一，获取 @Value 的值</li><li>了解 ${ } 对应的解析器</li><li>了解 #{ } 对应的解析器</li><li>TypeConvert 的一项体现</li></ol><h3 id="_47-autowired-装配底层" tabindex="-1"><a class="header-anchor" href="#_47-autowired-装配底层" aria-hidden="true">#</a> 47) @Autowired 装配底层</h3><h4 id="演示-autowired-装配过程" tabindex="-1"><a class="header-anchor" href="#演示-autowired-装配过程" aria-hidden="true">#</a> 演示 - @Autowired 装配过程</h4><h5 id="代码参考-44" tabindex="-1"><a class="header-anchor" href="#代码参考-44" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a47</strong> 包</p><h4 id="收获💡-59" tabindex="-1"><a class="header-anchor" href="#收获💡-59" aria-hidden="true">#</a> 收获💡</h4><ol><li>@Autowired 本质上是根据成员变量或方法参数的类型进行装配</li><li>如果待装配类型是 Optional，需要根据 Optional 泛型找到 bean，再封装为 Optional 对象装配</li><li>如果待装配的类型是 ObjectFactory，需要根据 ObjectFactory 泛型创建 ObjectFactory 对象装配 <ul><li>此方法可以延迟 bean 的获取</li></ul></li><li>如果待装配的成员变量或方法参数上用 @Lazy 标注，会创建代理对象装配 <ul><li>此方法可以延迟真实 bean 的获取</li><li>被装配的代理不作为 bean</li></ul></li><li>如果待装配类型是数组，需要获取数组元素类型，根据此类型找到多个 bean 进行装配</li><li>如果待装配类型是 Collection 或其子接口，需要获取 Collection 泛型，根据此类型找到多个 bean</li><li>如果待装配类型是 ApplicationContext 等特殊类型 <ul><li>会在 BeanFactory 的 resolvableDependencies 成员按类型查找装配</li><li>resolvableDependencies 是 map 集合，key 是特殊类型，value 是其对应对象</li><li>不能直接根据 key 进行查找，而是用 isAssignableFrom 逐一尝试右边类型是否可以被赋值给左边的 key 类型</li></ul></li><li>如果待装配类型有泛型参数 <ul><li>需要利用 ContextAnnotationAutowireCandidateResolver 按泛型参数类型筛选</li></ul></li><li>如果待装配类型有 @Qualifier <ul><li>需要利用 ContextAnnotationAutowireCandidateResolver 按注解提供的 bean 名称筛选</li></ul></li><li>有 @Primary 标注的 @Component 或 @Bean 的处理</li><li>与成员变量名或方法参数名同名 bean 的处理</li></ol><h3 id="_48-事件监听器" tabindex="-1"><a class="header-anchor" href="#_48-事件监听器" aria-hidden="true">#</a> 48) 事件监听器</h3><h4 id="演示-事件监听器" tabindex="-1"><a class="header-anchor" href="#演示-事件监听器" aria-hidden="true">#</a> 演示 - 事件监听器</h4><h5 id="代码参考-45" tabindex="-1"><a class="header-anchor" href="#代码参考-45" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a48</strong> 包</p><h4 id="收获💡-60" tabindex="-1"><a class="header-anchor" href="#收获💡-60" aria-hidden="true">#</a> 收获💡</h4><p>事件监听器的两种方式</p><ol><li>实现 ApplicationListener 接口 <ul><li>根据接口泛型确定事件类型</li></ul></li><li>@EventListener 标注监听方法 <ul><li>根据监听器方法参数确定事件类型</li><li>解析时机：在 SmartInitializingSingleton（所有单例初始化完成后），解析每个单例 bean</li></ul></li></ol><h3 id="_49-事件发布器" tabindex="-1"><a class="header-anchor" href="#_49-事件发布器" aria-hidden="true">#</a> 49) 事件发布器</h3><h4 id="演示-事件发布器" tabindex="-1"><a class="header-anchor" href="#演示-事件发布器" aria-hidden="true">#</a> 演示 - 事件发布器</h4><h5 id="代码参考-46" tabindex="-1"><a class="header-anchor" href="#代码参考-46" aria-hidden="true">#</a> 代码参考</h5><p><strong>com.itheima.a49</strong> 包</p><h4 id="收获💡-61" tabindex="-1"><a class="header-anchor" href="#收获💡-61" aria-hidden="true">#</a> 收获💡</h4><p>事件发布器模拟实现</p><ol><li>addApplicationListenerBean 负责收集容器中的监听器 <ul><li>监听器会统一转换为 GenericApplicationListener 对象，以支持判断事件类型</li></ul></li><li>multicastEvent 遍历监听器集合，发布事件 <ul><li>发布前先通过 GenericApplicationListener.supportsEventType 判断支持该事件类型才发事件</li><li>可以利用线程池进行异步发事件优化</li></ul></li><li>如果发送的事件对象不是 ApplicationEvent 类型，Spring 会把它包装为 PayloadApplicationEvent 并用泛型技术解析事件对象的原始类型 <ul><li>视频中未讲解</li></ul></li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vingkin/Blog/edit/main/src/interview/systemdesign/framework/spriiiiing.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 1830053226@qq.com">vingkin</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a aria-label="Spring" class="vp-link nav-link prev nav-link prev" href="/Blog/interview/systemdesign/framework/Spring.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->Spring</div></a><a aria-label="SpringMVC" class="vp-link nav-link next nav-link next" href="/Blog/interview/systemdesign/framework/SpringMVC.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">SpringMVC<!----></div></a></nav><div id="comment" class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">昵称</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">邮箱</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">网址</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="请留言。(填写邮箱可在被回复时收到邮件提醒)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>预览:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="表情" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="表情包"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="上传图片"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="预览"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <!--v-if-->  字</div><button type="button" class="wl-btn">登录</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->提交<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="搜索表情包"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> 评论</div><ul class="wl-sort"><!--[--><li class="active">按正序</li><li class="">按倒序</li><li class="">按热度</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v2.15.8</div></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright © 2023 Vingkin</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/Blog/assets/app-ee96bbef.js" defer></script>
  </body>
</html>
